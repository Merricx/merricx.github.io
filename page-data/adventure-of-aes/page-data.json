{"componentChunkName":"component---src-templates-blog-post-js","path":"/adventure-of-aes/","result":{"data":{"site":{"siteMetadata":{"title":"Merricx","author":"merricx"}},"markdownRemark":{"id":"55559ee5-b91b-5b33-85b2-9be72ef06379","html":"<p>In this article, I want to share my personal learning journey and experience on how I practiced to do cryptanalysis on reduced round AES step by step from the easiest one which is 1-round AES until 3-round AES. </p>\n<p>The attack that we will described here just mainly focus on the differential cryptanalysis of AES S-Box. According to the AES proposal <sup><a href=\"#references\">[1]</a></sup>, it is claimed that AES is resistant against differential cryptanalysis above 4-round. So, how about round below it? Lets find out!</p>\n<h1 id=\"preliminaries\"><a href=\"#preliminaries\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Preliminaries</h1>\n<p>Before we dive into the attack, it’s good idea to refresh our reference on short preliminaries about AES operations and basic of the attack that we gonna use.</p>\n<h2 id=\"aes\"><a href=\"#aes\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AES</h2>\n<p>Advanced Encryption Standard (AES) is the algorithm that was selected by NIST that originally named Rijndael. AES use <em>Substitution-Permutation Network</em> (SPN) as its main design. </p>\n<p>AES is 128-bit block cipher which its state represented as byte matrix of size 4x4. It consist of 4 main operations in single round which are <code class=\"language-text\">SubBytes</code>, <code class=\"language-text\">ShiftRows</code>, <code class=\"language-text\">MixColumns</code>, and <code class=\"language-text\">AddRoundKey</code>. </p>\n<p>The number of rounds used in AES depends on the key size, where 128-bit use 10 rounds, 192-bit use 12 rounds, and 256-bit use 14 rounds. In the first round, an additional <code class=\"language-text\">AddRoundKey</code> is used, and in the last round, <code class=\"language-text\">MixColumns</code> operation is omitted.</p>\n<p>This is how AES encryption works in nutshell:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">AES</span><span class=\"token punctuation\">(</span>plaintext<span class=\"token punctuation\">,</span> master_key<span class=\"token punctuation\">,</span> n_rounds<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    round_key <span class=\"token operator\">=</span> key_schedule<span class=\"token punctuation\">(</span>master_key<span class=\"token punctuation\">)</span>\n\n    state <span class=\"token operator\">=</span> add_round_key<span class=\"token punctuation\">(</span>plaintext<span class=\"token punctuation\">,</span> round_key<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> n_rounds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        state <span class=\"token operator\">=</span> sub_bytes<span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">)</span>\n        state <span class=\"token operator\">=</span> shift_rows<span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">)</span>\n        state <span class=\"token operator\">=</span> mix_columns<span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">)</span>\n        state <span class=\"token operator\">=</span> add_round_key<span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> round_key<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># last round without MixColumns</span>\n    state <span class=\"token operator\">=</span> sub_bytes<span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">)</span>\n    state <span class=\"token operator\">=</span> shift_rows<span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">)</span>\n    state <span class=\"token operator\">=</span> add_round_key<span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">,</span> round_key<span class=\"token punctuation\">[</span>n_rounds<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> state</code></pre></div>\n<h3 id=\"subbytes\"><a href=\"#subbytes\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SubBytes</h3>\n<p><code class=\"language-text\">SubBytes</code> will apply substitution mapping on each byte of the state against S-Box. This operation is the only operation in AES that is not linear.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/db12ff41e9da9ba552916974fcb5ed3f/34e70/subbytes.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 33.108108108108105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABEElEQVR42n1R2W6DQAzk//8rfeoDNIQzBZblEDci4SVKmO44ouqlWhqtd+0Z22urCkOUZQmV56iqSvx1XUHbtu0T+53W9RO8sESmCmj95GmtMU0TrPxwgEpTxOcz0iQRwXmefwl+FVa6xcurhusZTvpukCIx3GEYYL3ZNqIowul0guM44nddh7/s8Xg8OzTxwEwWxzGUUiJGUenQdV2EJng2HQZBAM/zUBQFlmWRTq/Xq5xMJinLMpmChcnxfV/45HFs63g8SgUmMoHn3uH9fpeudtxuN3mv61o4FCXoU5TvFitQiNiDTdN8W8JPY5x55HJswjZfJ4J938tn7svgaJfL5d+ljOMoohQgyGnbVs4PLAQLv4DQ5Y0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"subbytes\"\n        title=\"\"\n        src=\"/static/db12ff41e9da9ba552916974fcb5ed3f/fcda8/subbytes.png\"\n        srcset=\"/static/db12ff41e9da9ba552916974fcb5ed3f/12f09/subbytes.png 148w,\n/static/db12ff41e9da9ba552916974fcb5ed3f/e4a3f/subbytes.png 295w,\n/static/db12ff41e9da9ba552916974fcb5ed3f/fcda8/subbytes.png 590w,\n/static/db12ff41e9da9ba552916974fcb5ed3f/efc66/subbytes.png 885w,\n/static/db12ff41e9da9ba552916974fcb5ed3f/34e70/subbytes.png 1053w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3 id=\"shiftrows\"><a href=\"#shiftrows\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ShiftRows</h3>\n<p><code class=\"language-text\">ShiftRows</code> is the operation that will shift byte position each row to the left depending on the row. Second row will be shifted 1 to the left, third row shifted 2 to the left, and fourth row shifted 3 to the left (first row stay the same).</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ba452bab160938260c333bedeea4b8ce/34e70/shiftrows.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 33.108108108108105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABNklEQVR42n1RaWvCQBDN//9Jban0wBa1SKwJSfZI1lzmTj2+iPq6OxLpRQeGnZ3jzXuM5bEMaZpitVLIsku83+9h7Hw+X334G6vqDq6fIlIJ4nhFc0kSo+87WM8ThTBU4IxBypAA+77/BfgVWMUlxrMYS5cjlILmhJCo6wbW7chGEARwHAe2fYmrqsJfdjqdLgx13fd9ME1CqQgqkhhPJQLZwroZLanIOYfneXBdV9NPsNlsiOlut6O36zqtJEQURaTCLBaCYfHuYfLGMJtzcJkahgsIKanRgJp3YHg8HonV4IfDgfJ5npNExgLM7QCPLwKMSzR1CevuwSEg42ar1OBFUXw7wk8ry4L67p9cvE41U85IWVlWsAJZoWma6zGMtO12++9R2ralpR7LtcwMH/q66/Wa8p+LPQnLA7oQ2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"shiftrows\"\n        title=\"\"\n        src=\"/static/ba452bab160938260c333bedeea4b8ce/fcda8/shiftrows.png\"\n        srcset=\"/static/ba452bab160938260c333bedeea4b8ce/12f09/shiftrows.png 148w,\n/static/ba452bab160938260c333bedeea4b8ce/e4a3f/shiftrows.png 295w,\n/static/ba452bab160938260c333bedeea4b8ce/fcda8/shiftrows.png 590w,\n/static/ba452bab160938260c333bedeea4b8ce/efc66/shiftrows.png 885w,\n/static/ba452bab160938260c333bedeea4b8ce/34e70/shiftrows.png 1053w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3 id=\"mixcolumns\"><a href=\"#mixcolumns\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MixColumns</h3>\n<p>The third operation which is <code class=\"language-text\">MixColumns</code> will transform all bytes in the same column by multiply them with the constant 4x4 Matrix over the field $GF(2^8)$.</p>\n$$\n\\begin{bmatrix}\n2 &3 &1 &1\\\\\n1 &2 &3 &1\\\\\n1 &1 &2 &3\\\\\n3 &1 &1 &2\n\\end{bmatrix}\n\\begin{bmatrix}\na0\\\\\na1\\\\\na2\\\\\na3\n\\end{bmatrix}\n=\n\\begin{bmatrix}\nb0\\\\\nb1\\\\\nb2\\\\\nb3\n\\end{bmatrix}\n$$\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/90437da687b0642041d3b8804ee9459f/34e70/mixcolumns.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 33.108108108108105%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABJUlEQVR42m2R3W6CQBCFef/XEdA2aWqbtvdQBAQK+ANFDUhUbgxwumeaNWnqJJNhlz3fntkxFn6AoiiwXq9RlqV8d10HxjiOt9RrRl038BY+8nyFzWYjOtbj8Qjj6XmOfLVCHMdI00yAbdv+AzKHYZD9OElgT2cIl0ulSZFlmdS6rmG8vX8gUQc8z4PjOIiiCIfDAfdCA1MFmL+8Koe5JIFMccibCCE0DEP4vo/tdovT6SROL5eLVB6mCz5NpLqZmLbogiAQHfVs3ZiYltB5EzdZtcO+78WVzuv1+utQPc3s4RGBAhGq297v9zAseyobhOmfu93uzxB06HWSfMG0bDiuKzq+PzujEYNTbprmNgy2dj6f7w5FA8vyG+6nJ5qqqkTDSs4P6BUHS4QAkesAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"mixcolumns\"\n        title=\"\"\n        src=\"/static/90437da687b0642041d3b8804ee9459f/fcda8/mixcolumns.png\"\n        srcset=\"/static/90437da687b0642041d3b8804ee9459f/12f09/mixcolumns.png 148w,\n/static/90437da687b0642041d3b8804ee9459f/e4a3f/mixcolumns.png 295w,\n/static/90437da687b0642041d3b8804ee9459f/fcda8/mixcolumns.png 590w,\n/static/90437da687b0642041d3b8804ee9459f/efc66/mixcolumns.png 885w,\n/static/90437da687b0642041d3b8804ee9459f/34e70/mixcolumns.png 1053w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<blockquote>\n<p><strong>NOTE</strong>: we can treat this operation as black box function that transform 4-byte input into another 4-byte output.</p>\n</blockquote>\n<h3 id=\"addroundkey\"><a href=\"#addroundkey\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AddRoundKey</h3>\n<p>The last operation is <code class=\"language-text\">AddRoundKey</code> which simply XOR the state with the <code class=\"language-text\">RoundKey</code>. </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3ba8192fe1d16a4d4a37008151a31ff6/82c1e/addroundkey.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 53.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWUlEQVR42p1SXW+DMAzM//81e93btMdpmqYBCpQA5XNQtYBoS8toucWuMqFu1aRaOpGE+Hw+R7y8F4giBaUCFEWB0+kEimmaGCbM3pwNX0e8qUf4kYNlFCMMAzRNA/H2QRsF27aRpinO5zPmcTgcGNdxHI54dZ4QZ6EWtEQQBGjbFkIpD4kmklJqlQrb7Zax3+8ZcRzD8zw+67qOUZYlYxklKPICvu9r0gjr9RrC0srCMGSFi8UCwzCwStM6tVFVFa/HcWTQv77vIV3JOY7jMFarFQRdJu+yLONEQ2SCCHa73a+WqTCpN7m0rusaYm723HRSOY4XJdQuFTL+/pVjIK4rT9MlqW9TlPIBVfmpqyfItM9mOPPpX8dNhV1TwbeekSSxRsKm05DuUHgh3GxqONJn04mQXsCc8KbCW4Q0Mduyfp6T67rs5d2E9N5ognmea7Ub/tKA/iP8BnlOTcrsxjw+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"addroundkey\"\n        title=\"\"\n        src=\"/static/3ba8192fe1d16a4d4a37008151a31ff6/fcda8/addroundkey.png\"\n        srcset=\"/static/3ba8192fe1d16a4d4a37008151a31ff6/12f09/addroundkey.png 148w,\n/static/3ba8192fe1d16a4d4a37008151a31ff6/e4a3f/addroundkey.png 295w,\n/static/3ba8192fe1d16a4d4a37008151a31ff6/fcda8/addroundkey.png 590w,\n/static/3ba8192fe1d16a4d4a37008151a31ff6/efc66/addroundkey.png 885w,\n/static/3ba8192fe1d16a4d4a37008151a31ff6/c83ae/addroundkey.png 1180w,\n/static/3ba8192fe1d16a4d4a37008151a31ff6/82c1e/addroundkey.png 1398w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p><code class=\"language-text\">RoundKey</code> is the subkey that expanded from <code class=\"language-text\">MasterKey</code> using the Key Schedule function, so it will generate different <code class=\"language-text\">RoundKey</code> on each round of AES. </p>\n<p>We can ignore how the Key Schedule function works since this is irrelevant with our attack. The only thing we must remember here is with any known <code class=\"language-text\">RoundKey</code>, we can recover its <code class=\"language-text\">MasterKey</code> since Key Schedule function is invertible.</p>\n<h2 id=\"differential-cryptanalysis\"><a href=\"#differential-cryptanalysis\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Differential Cryptanalysis</h2>\n<p>Differential Cryptanalysis is one of the most powerful method to attack block cipher and together with the Linear Cryptanalysis become two <em>de facto</em> standard of cryptanalysis against block cipher.</p>\n<p>Differential cryptanalysis usually uses bitwise XOR to define the “difference”. XOR operation is very useful given the fact that it can “bypass” or skip linear operation on block cipher.</p>\n<p>In the context of AES, assume we have the following equation:</p>\n$$\nc_1 = ARK(MC(SR(p_1))) \\\\\nc_2 = ARK(MC(SR(p_2))) \\\\\n$$\n<p>where $ARK$, $MC$, and $SR$ denote <code class=\"language-text\">AddRoundKey</code>, <code class=\"language-text\">MixColumns</code>, and <code class=\"language-text\">ShifRows</code> operation respectively. </p>\n<p>Then, lets assume differential of two plaintext and ciphertext is XOR between these pair that denoted by $p_1 \\oplus p_2$ and $c_1 \\oplus c_2$ respectively, then the equation become:</p>\n$$\nc_1 \\oplus c_2 = ARK(MC(SR(p_1 \\oplus p_2)))\n$$\n<p>Since $ARK$ is just XOR state with the <code class=\"language-text\">RoundKey</code> and both of $p_1$ and $p_2$ XORed with the same <code class=\"language-text\">RoundKey</code>, we can simplify the equation by removing $ARK$ at all.</p>\n$$\n\\begin{equation}\n\\begin{aligned}\nc_1 & = MC(SR(p_1)) \\oplus RoundKey \\\\\nc_2 & = MC(SR(p_2)) \\oplus RoundKey \\\\\nc_1 \\oplus c_2 & = MC(SR(p_1 \\oplus p_2)) \\oplus RoundKey \\oplus RoundKey \\\\\nc_1 \\oplus c_2 & = MC(SR(p_1 \\oplus p_2))\n\\end{aligned}\n\\end{equation}\n$$\n<p>And that’s it, we basically already bypass all linear operation even without the knowledge of <code class=\"language-text\">RoundKey</code>. </p>\n<blockquote>\n<p>Imagine AES without <code class=\"language-text\">SubBytes</code> operation, then if you know <code class=\"language-text\">c1</code>, <code class=\"language-text\">c2</code>, and <code class=\"language-text\">p1</code>, it is become trivial to recover <code class=\"language-text\">p2</code>, just like what happen in simple XOR cipher.</p>\n</blockquote>\n<p>This way, we only need to focus on one operation that is non-linear which is <code class=\"language-text\">SubBytes</code>. </p>\n<p>Consider $(x, y)$ for every possible byte values. Then, let $\\alpha = x \\oplus y$ and $\\beta = SB(x) \\oplus SB(y)$ where $SB$ denotes <code class=\"language-text\">SubBytes</code> operation. We are trying to analyze how many times $\\alpha$ and $\\beta$ hold.</p>\n<p>For example, let $\\alpha = 8$ and $\\beta = 125$. Over all 256 possible bytes, there are two possible byte pair $(x, y)$ that satisfy the condition which are $(1, 9)$ and $(9, 1)$. </p>\n$$\n\\begin{equation}\n\\begin{aligned}\n8 & = 1 \\oplus 9 = 9 \\oplus 1 \\\\\n125 & = SB(1) \\oplus SB(9) = SB(9) \\oplus SB(1)\n\\end{aligned}\n\\end{equation}\n$$\n<p>So, the probability of ($\\alpha$, $\\beta$) being $(1, 8)$ are 2/256. </p>\n<p>And that is what Differential Cryptanalysis is all about, we find the probability of input differential ($\\alpha$) that will resulting to the specific output differential ($\\beta$) through S-BOX.</p>\n<h2 id=\"differential-in-aes-s-box\"><a href=\"#differential-in-aes-s-box\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Differential in AES S-box</h2>\n<p>In order to find differential property of S-Box, we must first find the distribution of the differences between pairs of input and pairs of output values. This can be achieved from S-Box <strong>Differential Distribution Table</strong> (DDT), which is the table that shows the number of occurences every possible input difference that results in coresponding output difference.</p>\n<p>S-Box DDT can be quickly built with the following Python code:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">SBOX <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># 1D list of AES S-Box</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">generate_sbox_ddt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    table <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token number\">256</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            diff_input <span class=\"token operator\">=</span> i <span class=\"token operator\">^</span> j\n            diff_output <span class=\"token operator\">=</span> SBOX<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">^</span> SBOX<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">[</span>diff_input<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                table<span class=\"token punctuation\">[</span>diff_input<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>diff_output<span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                table<span class=\"token punctuation\">[</span>diff_input<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token number\">256</span>\n                table<span class=\"token punctuation\">[</span>diff_input<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>diff_output<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n\n    <span class=\"token keyword\">return</span> table</code></pre></div>\n<p>If we look closely on the S-Box DDT result, each row of table have kind of similar occurence distribution where it contains either 0 or 2 and one time occurence of 4 (except the first row where input equal to zero).</p>\n<p>Below is the sample of the result showing 2nd and 65th row:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[0, 2, 0, 0, 2, 0, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 0, 0, 2, 2, 0, 0, 2, 2, 2, 0, 0, 0, 2, 4, 0, 2, 2, 0, 2, 0, 0, 0, 0, 2, 2, 0, 0, 2, 0, 2, 2, 2, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 2, 0, 0, 0, 2, 0, 0, 0, 2, 2, 0, 2, 2, 2, 0, 2, 2, 0, 2, 0, 2, 2, 0, 0, 0, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 2, 2, 0, 2, 0, 0, 0, 2, 2, 2, 2, 0, 2, 0, 0, 0, 2, 0, 0, 2, 0, 0, 2, 2, 0, 0, 0, 2, 0, 0, 2, 0, 2, 2, 2, 2, 0, 2, 0, 2, 2, 0, 0, 0, 2, 0, 0, 2, 0, 2, 0, 0, 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 2, 0, 0, 2, 0, 2, 2, 2, 2, 2, 2, 0, 0, 2, 0, 2, 0, 2, 2, 2, 2, 0, 0, 2, 0, 2, 0, 0, 0, 0, 2, 2, 2, 0, 0, 0, 2, 2, 0, 2, 0, 2, 2, 2, 2, 2, 0, 2, 2, 0, 0, 0, 0, 2, 0, 0, 0, 2, 2, 0, 0, 2, 2, 0, 0, 2, 0, 0, 2, 0, 0, 2, 0, 0, 2, 2, 2, 0, 0, 2, 0, 0, 0, 2, 2, 2, 0, 2, 2, 0, 0, 0, 2]\n\n[0, 2, 0, 0, 0, 2, 0, 0, 0, 0, 2, 2, 2, 0, 0, 2, 2, 0, 2, 0, 0, 2, 2, 0, 0, 0, 0, 2, 2, 0, 2, 2, 2, 2, 2, 0, 0, 0, 0, 2, 0, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 0, 0, 2, 2, 0, 0, 2, 0, 0, 0, 2, 0, 2, 0, 2, 0, 0, 0, 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0, 0, 2, 2, 2, 2, 2, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 4, 2, 0, 0, 0, 2, 0, 2, 2, 0, 2, 2, 0, 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0, 0, 0, 2, 2, 0, 0, 2, 0, 2, 0, 2, 0, 0, 0, 2, 0, 2, 2, 0, 0, 0, 0, 0, 2, 0, 0, 2, 0, 2, 2, 2, 2, 0, 0, 2, 2, 0, 2, 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 2, 2, 2, 2, 0, 2, 2, 0, 2, 0, 2, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 0, 2, 0, 2, 2, 0, 0, 0, 2, 2, 0, 2, 2, 2, 0, 0, 0, 0, 0, 2, 2, 0, 2, 0, 0, 0, 2, 0, 0, 2, 2, 2, 0, 0, 0, 2]</code></pre></div>\n<p>If we try to count those, we will find that on each row (except 1st row), 0 appears 129 times, 2 appears 126 times, and 4 appears 1 time.</p>\n<p>Lets consider $(\\alpha, \\beta)$ as input and output difference pairs of single AES S-box and $\\alpha \\neq 0$. Then we have following observation based from the S-Box DDT:</p>\n<ul>\n<li>For 129/256 of possible pairs $(\\alpha, \\beta)$, there is no such pair $(x, y)$ that $x \\oplus y = \\alpha$ and $SB(x) \\oplus SB(y) = \\beta$</li>\n<li>For 126/256 of possible pairs $(\\alpha, \\beta)$, there exist two pairs $(x, y)$ such that $x \\oplus y = \\alpha$ and $SB(x) \\oplus SB(y) = \\beta$</li>\n<li>For 1/256 of possible pairs $(\\alpha, \\beta)$, there exist four pairs $(x, y)$ such that $x \\oplus y = \\alpha$ and $SB(x) \\oplus SB(y) = \\beta$</li>\n</ul>\n<p>From the above observation, can be implied that if we know a pair of $(\\alpha, \\beta)$ then we can quickly recover $(x, y)$ which is the actual input/output value of the S-Box <sup><a href=\"#references\">[2]</a></sup>.</p>\n<h1 id=\"1-round-aes\"><a href=\"#1-round-aes\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1 Round AES</h1>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bb8d15f8bce519db63e888cd02422327/0ec65/round1-0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 39.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/UlEQVR42p2RR27FQAxD5/7nM/B37r33bit5AibINjFAa4pMUrS571vatpW6rhV938swDHJdl5znqWBtYfdN00hRFBIEgSRJIlVVyXEcYp7nkXmeFXmey77v2rwsi2Jd1x9s26aVc9d1VRhSjGAKYsMmyzLxfV88z9NKo3UKpmlSwXEcdQ0gx0CapoqyLKXrOjFxHCs7SlxAEIahqkZRpI3cUXGOOBUyzuhlTb+OzCHz44hLlD+fj47OCKjSTB/O+JjKHcSYQAQj5Gvk+/mdDc3kavOjQo66XVP5MYiRpeM4Svi+rxhe/3kgJFMbCeLkrIR/hSVkZOKg4pBJvwCCrWUPdayDWwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round1 0\"\n        title=\"\"\n        src=\"/static/bb8d15f8bce519db63e888cd02422327/fcda8/round1-0.png\"\n        srcset=\"/static/bb8d15f8bce519db63e888cd02422327/12f09/round1-0.png 148w,\n/static/bb8d15f8bce519db63e888cd02422327/e4a3f/round1-0.png 295w,\n/static/bb8d15f8bce519db63e888cd02422327/fcda8/round1-0.png 590w,\n/static/bb8d15f8bce519db63e888cd02422327/efc66/round1-0.png 885w,\n/static/bb8d15f8bce519db63e888cd02422327/c83ae/round1-0.png 1180w,\n/static/bb8d15f8bce519db63e888cd02422327/0ec65/round1-0.png 2009w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Let’s start breaking 1 round AES with the differential cryptanalysis!</p>\n<p>Consider $(p_1, c_1)$ and $(p_2, c_2)$ are plaintext-ciphertext pairs of 1-round AES, where all these values are known to us and we want to find the <code class=\"language-text\">MasterKey</code> (known-plaintext scenario). </p>\n<p>Let differential of $(p_1, p_2)$ denoted by $\\alpha$ and differential of $(c_1, c_2)$ denoted by $\\beta$.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/24978624e42f668e8563e771d7f0fd22/b5cea/round1-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABMElEQVR42oWS64qDQAyF5/0fr79UlGqtWotWbb2gVbN8gSxuKeyBYGaSHM8kceu6StM00ve9vF4veT6fMk2T+suyyPV6lTzPJY5jCYJAQNd1Gjeb51nattWvowgywCUJVsT5fr9LlmWSpqkkSaKkRVFoDgTkATjGcRSHwrquNUDx7XZTImzbNvkEAkwhL3s8HkqGT8wdkwlUVaW+ke37/sfsDqAIwiMcqggg/3K5SBRFX4m+EZN/Op2077wS36FoGAY165XhP0JqIeXMIBHnrJAnopTecX6/3/INlkvvEWG9thY5HCSb0XCI6Sd/5cw9q8PAbAOIY/gQ89WhoIQLwKTKsvyd5vl8Fs/zxPd9XRcsDENtja0NPzJf1waFEJl8mstK2Dp8AtXkkI/y49pA+gOjQQRRYnFWYQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round1 1\"\n        title=\"\"\n        src=\"/static/24978624e42f668e8563e771d7f0fd22/fcda8/round1-1.png\"\n        srcset=\"/static/24978624e42f668e8563e771d7f0fd22/12f09/round1-1.png 148w,\n/static/24978624e42f668e8563e771d7f0fd22/e4a3f/round1-1.png 295w,\n/static/24978624e42f668e8563e771d7f0fd22/fcda8/round1-1.png 590w,\n/static/24978624e42f668e8563e771d7f0fd22/efc66/round1-1.png 885w,\n/static/24978624e42f668e8563e771d7f0fd22/b5cea/round1-1.png 1140w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>We then apply $MC^{-1}$ and $SR^{-1}$ to $\\beta$. Now we have one-on-one byte relation of $\\alpha$ and $\\beta$ through S-Box.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/291436cf178e716bfc221df34125211d/772aa/round1-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 21.62162162162162%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7UlEQVR42lWPuXKDQBBE9f8f4NixyrEDO5UDH5EPCiQBYjkEC8hoYQvQCp7xOnJXzdQcPV09K5hR6swwDPzHbPO3GgjDkKIobK9USxLH5PLEaP6Yfd9T1ydbrzavMUEQIYSgbVvmecYYY+Um07N7W+N57sIJ6LqOPD/y6WzZvz9Qi2d0b/BcD8f9YOOsWd3e+ex9wTFLaZozWmuklKhWo1VJ9HKzOBIkSWrnUhYEh4zMeyT+ukd1IyKKCKMdT+4imCWBdeD7vhX7xTRNS1wx14lDXNqXo+VoHEeqqmK/2xKnklZfuFxGArsXlHnDD04cKmPUbTJvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round1 2\"\n        title=\"\"\n        src=\"/static/291436cf178e716bfc221df34125211d/fcda8/round1-2.png\"\n        srcset=\"/static/291436cf178e716bfc221df34125211d/12f09/round1-2.png 148w,\n/static/291436cf178e716bfc221df34125211d/e4a3f/round1-2.png 295w,\n/static/291436cf178e716bfc221df34125211d/fcda8/round1-2.png 590w,\n/static/291436cf178e716bfc221df34125211d/efc66/round1-2.png 885w,\n/static/291436cf178e716bfc221df34125211d/c83ae/round1-2.png 1180w,\n/static/291436cf178e716bfc221df34125211d/772aa/round1-2.png 2042w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Then, consider $x$ and $y$ where we try all possible values until they satisfy following conditions:</p>\n<ul>\n<li>$x \\oplus y \\neq 0$</li>\n<li>$x \\oplus y = \\alpha$</li>\n<li>$SB(x) \\oplus SB(y) = \\beta$. </li>\n</ul>\n<p>According to the differential observation that explained before, it should exist two possible pairs $(x, y)$ that satisfy those conditions.</p>\n<p>Alternatively, we can optimize our finding of possible $(x, y)$ value using S-Box DDT that we built previously. This way, we can just do table lookup of $\\alpha$ and $\\beta$ to quickly find possible $(x, y)$ instead of using brute-force. But, we need to slightly modify our S-Box DDT to store the actual value of $(x, y)$ instead of the number of occurence.</p>\n<p>Below is the Python implementation that generate S-Box DDT lookup:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">SBOX <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># 1D list of AES S-Box</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">generate_sbox_ddt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    table <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">*</span> <span class=\"token number\">256</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            diff_input <span class=\"token operator\">=</span> i <span class=\"token operator\">^</span> j\n            diff_output <span class=\"token operator\">=</span> SBOX<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">^</span> SBOX<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span>\n\n            <span class=\"token keyword\">if</span> <span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">[</span>diff_input<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\n                table<span class=\"token punctuation\">[</span>diff_input<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>diff_output<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span><span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n                table<span class=\"token punctuation\">[</span>diff_input<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n                table<span class=\"token punctuation\">[</span>diff_input<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>diff_output<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">,</span> j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> table\n\nddt <span class=\"token operator\">=</span> generate_sbox_ddt<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Lookup the table</span>\nalpha <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> \nbeta <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\npossible_xy <span class=\"token operator\">=</span> ddt<span class=\"token punctuation\">[</span>alpha<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>beta<span class=\"token punctuation\">]</span></code></pre></div>\n<p>Okay, so what’s next after we found the value of $(x, y)$ ?</p>\n<p>Remember that before round 1, there is additional <code class=\"language-text\">AddRoundKey</code> before the very first <code class=\"language-text\">SubBytes</code> operation. So, the value of $(x, y)$ is the value of either $ARK(p_1)$ or $ARK(p_2)$. Thus, we can find possible $RK_0$ by simply XORing $x$ or $y$ with the respective byte of $p_1$ or $p_2$. </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1369b8cf4afd28c1a866806e7571c150/2fb55/round1-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 83.1081081081081%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACUElEQVR42oVUWXPaMBD2//8bfWuf+9ZjOpMe6UGTEEjMaTDG+OIQxtiW7a+7AqlA6HQ9OzpW++nbQ7ZwlIa/plHzzW6N4XCEoiwOtuZoI5W0Hk0nmHseqqoydi2WAawPm8vpBo8fbIynI4RBaA43da3G8LYD5/sDHM+F2Gz+D7hyBdrvbTjuGAt/gfoIpAH938/ofvmJ3nCA1Wp1HdCERFLIAvPQw3QyRRzHxqbtGdmjZYKEbPv9Hpf+llpolsfNSlbmMPD3dr2UZYmS9JIdzw1DnWAWDrMoCjPP81ypdpZSKtVSUbr02mKgMAjgui7SNDWH9AHOk23b6Ha72O12BwDy0blFLREHc4wdR0Vl9QYrvH47gj+fIKCqMlBKjnEUqPNJ5xW853dwvQjpViiWG6puHCfK/m2Q4M1ND4E3wYKIWctkjR+tDp6eunBnMxXadrtFslyiKiXcfgcP97/Qbj8iSRKVCgZUFW4qOP4SX++eMRz0MZ/7sMpdChFHWNONGQFVrFRBcE6J7T7LIcSWVJhCnEotS6RijYh8OGUWdLsci8CARRietcJZkU/aSHdITWNBkZk+5ARnWXa4kVhUx+IoOCKaE0sO0TT5RW/ymJ8C8obuu5pGuV5TLx7C+zi4waf2Z4z7Iwgqyr8ANSHr8gZmKDmPRa4otib3aNl3cEaOKtY1wNMIDaBpZAKWQpicZSJD6AeY0d9FO11jqCO0LikzYCXE2bPi39g+2794aqeFepFDBuSXsONRz0n55oAaNooi1Ta81k+Ro2LlPf10/wBmvifKbjfb+AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round1 3\"\n        title=\"\"\n        src=\"/static/1369b8cf4afd28c1a866806e7571c150/fcda8/round1-3.png\"\n        srcset=\"/static/1369b8cf4afd28c1a866806e7571c150/12f09/round1-3.png 148w,\n/static/1369b8cf4afd28c1a866806e7571c150/e4a3f/round1-3.png 295w,\n/static/1369b8cf4afd28c1a866806e7571c150/fcda8/round1-3.png 590w,\n/static/1369b8cf4afd28c1a866806e7571c150/efc66/round1-3.png 885w,\n/static/1369b8cf4afd28c1a866806e7571c150/c83ae/round1-3.png 1180w,\n/static/1369b8cf4afd28c1a866806e7571c150/2fb55/round1-3.png 2201w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Thats it! We can iterate this process for all byte position of $RK_0$. Note that there will always be 2 possible values for each byte position of $RK_0$ (except the differential is zero), so we can do trial encryption/decryption with the obtained possible key to get the correct key with only $2^{16}$ trials.</p>\n<blockquote>\n<p><strong>NOTE:</strong> Because we already found <code class=\"language-text\">RoundKey</code> of round 0, we don’t need to reverse the key expansion since this <code class=\"language-text\">RoundKey</code> is already equal to the AES <code class=\"language-text\">MasterKey</code></p>\n</blockquote>\n<h1 id=\"2-round-aes\"><a href=\"#2-round-aes\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2 Round AES</h1>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fcc0f132337f377ec225cac5ba1d2b2a/cdaca/round2-0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABT0lEQVR42p3S125EMQgEUP//5+3bStt7703b2BwkR8ljciWE7wDDgF2ez2dsNptYrVaxXq9jt9vF4XCIx+MR9/s9zfmnweTP5/Po9XoxmUzyX6y8Xq84nU5ps9ksrtdrNjifz2mXyyUNXk1up9OJ/X6fNYQwxAXzdDqNbrebpqPE7XabatnxeEyDU++sGYLxeJx+uVxmrIxGoywGIJY8HA5TpZiGi8UiPcyYPEyNHGeYSQrJtUO73U4VjUYju1FciygxljMvRoCJBoNBjt5sNqPUbhIR9/v97EYlTDIyBWIwXiOxVquVQuCwAqyLr7KtwOj25wyjymUY3f4Uy68XYjK3X/zYC8DNIaJIAVUMkRE1MEXNUVcv5nuH8fVhtjNPAugp3W63PPNwOfUpIfR+4cisQFNYeb/f8Z9PA1NRaX+/FCL9i1VCK7Aal2rXFH8AG9BEsHEfp7QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round2 0\"\n        title=\"\"\n        src=\"/static/fcc0f132337f377ec225cac5ba1d2b2a/fcda8/round2-0.png\"\n        srcset=\"/static/fcc0f132337f377ec225cac5ba1d2b2a/12f09/round2-0.png 148w,\n/static/fcc0f132337f377ec225cac5ba1d2b2a/e4a3f/round2-0.png 295w,\n/static/fcc0f132337f377ec225cac5ba1d2b2a/fcda8/round2-0.png 590w,\n/static/fcc0f132337f377ec225cac5ba1d2b2a/efc66/round2-0.png 885w,\n/static/fcc0f132337f377ec225cac5ba1d2b2a/c83ae/round2-0.png 1180w,\n/static/fcc0f132337f377ec225cac5ba1d2b2a/cdaca/round2-0.png 2021w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Can we extend our previous attack to make it works against 2 round AES?</p>\n<p>Consider $(p_1, c_1)$ and $(p_2, c_2)$ are plaintext-ciphertext pairs of 2-round AES and $(\\alpha, \\beta)$ are input-output difference pairs of $(p_1, p_2)$ and $(c_1, c_2)$ respectively.</p>\n<p>If we illustrate this scenario into 2-round AES, we can bypass first <code class=\"language-text\">AddRoundKey</code> and <code class=\"language-text\">ShiftRows</code> by swapping operation order with <code class=\"language-text\">SubBytes</code>. Then, in the last round, we can bypass <code class=\"language-text\">ShiftRows</code>, <code class=\"language-text\">MixColumns</code>, and <code class=\"language-text\">AddRoundKey</code>. So, the view become $\\alpha \\circ SB \\circ MC \\circ ARK \\circ SB \\circ \\beta$.</p>\n<p>Unfortunately, there are already too many operation between <code class=\"language-text\">SubBytes</code> that will significantly mess our differential distribution. Moreover, <code class=\"language-text\">MixColumns</code> will also prevent us to work on one-on-one byte relation, since this operation works on 4-bytes at once. This is already too much and too complex. Thus, we need different strategy that much more simple. </p>\n<p>The key point here is that we can only “bypass” <code class=\"language-text\">SubBytes</code> with differential <strong>once</strong> at a time. But then, there are two <code class=\"language-text\">SubBytes</code> in 2-round AES, how can we bypass the other one?</p>\n<h3 id=\"half-last-round\"><a href=\"#half-last-round\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Half Last Round</h3>\n<p>To simplify our understanding of the attack, lets first assume that last round does not make use of <code class=\"language-text\">MixColumns</code> (usually called half round). So, in the round 2, the operation flow is only $SB \\circ SR \\circ ARK$.</p>\n<p>Let $\\alpha$ be differential of plaintext $(p_1, p_2)$ where only the first column has <strong>active</strong> byte, which is byte with non-zero differential. Any other value should be zero differential or <strong>inactive</strong> byte. Since we need this spesific plaintext value, so this attack only applicable in chosen-plaintext scenario.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2a62cd934ac006b24cd5bf13a4aa0993/8b936/round2-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACWElEQVR42p2VzW7TQBDH/RYceAQ4ceAVeAsOPAAHTnxItOUAR6QUCXGtVFQJkBCIC1CQohQuCCGaREnqz43tOLFjO07i2o7tP95NHMhHU5eRRrsae3+emZ0Zc5hJu02Qpinb0zXfX1Q4V/wASz6CqpuwLBOe5y2ALwwUD65C+Hwbmhmi1axD0zQkSfL/QOn1dQhf76JjheBPmjAMoxBwXXroykmvrqH58Q54YuP49y9IkoQ4js8ELoPSf+wMqLy/AVJ5CMOOQBQRqqpuBk4fsDWdvZNHxEKOJ6dI4gij0QhRFK2EsMbFOYiK7/vzNFFHuPwINYZhuBjOGs298QIft77s4bD2E32jB03XYZpmBpx9qdFoYDweF75Nyx/i8v4DvPx2CFPVIckS9AzK0Yfdbhflchm1Wg2O46DX6zGldqrUe6qdToeVVb9nwhx7uPLmMd7+qGBg9qEQws4w4GQyQb1eh23bLCSay7M0oGmJE+bhpf372Dv6BCcLWRBF9nEunuWEwii4qPhRiO3v71BpHsMxLRgZzHXdqYdToDMHbrqUdX2epMncxhHdh0RcDD2X9fFwONxYNrktiifQXIuliGle2PeeatjZPYFjKeB5CbIsL3i6LMnMRjLYzYMSu1l6hud5dqHc1jMdT17IGNgkazvCaqlI61Gv/OB0dThs7erYLjXQ1VtonQiFezkIAlSr1WyOtkGykqFe0j336HkHO6V6VlsiFEWFIAiFgPSdwWAwLyfaZXTl9G7Wi+YY/Wy40nCp8bzxtWmscX9/AW2W4PN+ASvja0n/ALZD/sn4zibPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round2 1\"\n        title=\"\"\n        src=\"/static/2a62cd934ac006b24cd5bf13a4aa0993/fcda8/round2-1.png\"\n        srcset=\"/static/2a62cd934ac006b24cd5bf13a4aa0993/12f09/round2-1.png 148w,\n/static/2a62cd934ac006b24cd5bf13a4aa0993/e4a3f/round2-1.png 295w,\n/static/2a62cd934ac006b24cd5bf13a4aa0993/fcda8/round2-1.png 590w,\n/static/2a62cd934ac006b24cd5bf13a4aa0993/efc66/round2-1.png 885w,\n/static/2a62cd934ac006b24cd5bf13a4aa0993/c83ae/round2-1.png 1180w,\n/static/2a62cd934ac006b24cd5bf13a4aa0993/8b936/round2-1.png 1368w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Then, send $(p_1, p_2)$ to the encryption oracle which will give us corresponding $(c_1, c_2)$.</p>\n<p>If we remember our previous differential observation, there are 129/256 probability that differential input/output is impossible. Instead of using possible pair of differential, we will use the opposite which is the impossible pair. We can use this property as distinguisher whether our state is in correct state or not.</p>\n<p>So, the main idea here is to generate all <em>impossible</em> state at the start of round 2 just before second <code class=\"language-text\">SubBytes</code> using $\\alpha$. First, we want to bypass <code class=\"language-text\">SubBytes</code> using S-Box DDT like our previous attack on 1-round. But here, instead of finding possible S-Box output differential, we want to find impossible S-Box output differential. This will result in 129 impossible byte for each $\\alpha$ denoted by $\\mathbf{S} = (S_1, \\ldots, S_{129})$. Then, for each $S_i$ we apply $SR$, $MC$ and store this state to the list of impossible state.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/27af0c1a9bc34b1f1767e158088dbe39/c4cb0/round2-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 66.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACu0lEQVR42lVTW2sTQRTeP+LP8M0n/4Eg+CT4A/RR8El8EykoPggWFREsaBEK1rZqrZeisaba1qRtmnu32SZ7n83u7G72ls8zk6Tggclkz5z5zne+c0YZj8eYLWFa4EIzdERhKL+FP8/zs3NhaZbJ/VDV8aO2D9swwTmXPkXEFfSTFYV03NlZw4e/ZTDTQjwayUDf9+F5HlRVlXuSJDK2WrewW6mh3W7BpPgpYC54IM1z6ZirbOBrbQ+By1BQkozYjAg4JMaWZckEwldMCWRZIu+LJXyKaUdodH0q0UeapPDjCDyK5KWZZVl+Jou4lKYTQLHCKEHf8KGbATFPoZQrHh69bKOvNWE7DDGBhTwAY0yWlyYxASTEMEZEZ/9bgb4+xNuPdax9biDgIyj7DR+LKz1Y5gmCgJNuCXTDhq7ryAjIsEI0W12MIg9C777uotkZwA9iWabthvj28xjfyyolTaCI0vJClDLp4lHbx/wrkaAnAX9XHZT/NFDacWCzBNdu1XHhaherm4zwIiRpDnG1KKYa5vmkKUInYZWajfvP6uidNOG6HkxjgPmFQ2z+6sG0fFy+UcX5K10srdNocQcj0k3qO9VUEUCC4Qw44Am0AafORhRYgIcp2uoQRR5THFXQCbFb41TqSGo4YzZbiuWmeP5GRf90ouG4EMAZ/Q/OpA98D3mWTL9oH4szKpViRSNK2ypKvzUwL4IysFLcfdxAs1EjkKHMvPxJRYeGNUtj7B4wbO/U0eoakv2T1z3cnDvGly1TJnZZhHfrR1jZoOG2ORRRUrXuwjBEVyPUWg5uP9inBIfT16FhabWKxdVTGKaDS9cPcO5iHQ9fdBCHDiWJcaIxqJonZ1IJQw4eMHS7x8TQwzDIsFEy6Cnp8olxHuL9Zp+Y+HIeF5ZN3Hs6wNYekwLEcQzXseAxR87pP0dSyzdpKv1xAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round2 2\"\n        title=\"\"\n        src=\"/static/27af0c1a9bc34b1f1767e158088dbe39/fcda8/round2-2.png\"\n        srcset=\"/static/27af0c1a9bc34b1f1767e158088dbe39/12f09/round2-2.png 148w,\n/static/27af0c1a9bc34b1f1767e158088dbe39/e4a3f/round2-2.png 295w,\n/static/27af0c1a9bc34b1f1767e158088dbe39/fcda8/round2-2.png 590w,\n/static/27af0c1a9bc34b1f1767e158088dbe39/efc66/round2-2.png 885w,\n/static/27af0c1a9bc34b1f1767e158088dbe39/c83ae/round2-2.png 1180w,\n/static/27af0c1a9bc34b1f1767e158088dbe39/c4cb0/round2-2.png 2638w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<blockquote>\n<p>If we look at the image above, our impossible state is spreaded to all byte position despite only using 4-bytes. That is the main reason why we put active byte only on the same column.</p>\n</blockquote>\n<p>Then, we will guess one byte of $RK_2$ for every possible values and inverse the pair of ciphertext $(c_1, c_2)$ through $ARK$, $SR^{-1}$, and $SB^{-1}$ independently. Finally, we create differential of inversed $(c_1, c_2)$ denoted by $\\beta$ and compare with our generated impossible state. If $\\beta$ exist in the impossible state, then we know that our guess key is incorrect and we add it to the list of impossible key.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d0bfe0f7c8835cfa903e20ee9249fa7a/7edcf/round2-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 52.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBUlEQVR42lVT6W6bQBDm/Z+i6t9IfYC2UQ9ZidTErdrYZrENDsTlMCz3mpuvs4txk0ErhmX5jplBS7MCSVqibVuM4wgZ6n7Js6IC51zlVTMgDCP0fYe6rhGcQtS0J+N8rugbQHv/YYevdzaqqpVQmLAmsL6O4Ww+wjy8oCxLuMZn2Ic94iShlcFYLxE7d8hzAbZdY+V8g/bp+wH3S/cV4DiLQ98KOLslTPOAKIoof4D9bMF1XZxInb7+De5tkaY5dLaBddShSYBhGMlG/x+oq4mgmmzWHYoiV3ndDhBCoOs6Wi2YsUUiKqVeEnZND20YBqVM1nDoW3hBgR+//sLzpE2BPMsQx/HEhAsjRZrn2Osb+I8PSOmMFCRD6/tBKTuTIlEWcP0IK93G88GiZsRkLUAQBOqwJJ8EAJxItroOj9a8J91qM+PcCBltU1HXzldNs/3XIUF2exNJeUbTNFSWYlLoksUgElSr5k1DFBiVwDdXcBwHJRGUJxvu0VFdlrU09DW4rasampaFlWtDe3ezw+3CJgvFValaMm8EXh5pbEwLJ54gYQuYbA3X8+l8AmvHEG4WSIiAMYYv2z/Qfj75eGKcJF8sjm8H++iHBGiSxR6ZaGg8DGRZqhQywwDPStWQMAzRUBM1ziPqIleTP9udFcqNkYDkmKjHSy7rJ99LIPnXXEtE1z+QoUgAdPvlmAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round2 3\"\n        title=\"\"\n        src=\"/static/d0bfe0f7c8835cfa903e20ee9249fa7a/fcda8/round2-3.png\"\n        srcset=\"/static/d0bfe0f7c8835cfa903e20ee9249fa7a/12f09/round2-3.png 148w,\n/static/d0bfe0f7c8835cfa903e20ee9249fa7a/e4a3f/round2-3.png 295w,\n/static/d0bfe0f7c8835cfa903e20ee9249fa7a/fcda8/round2-3.png 590w,\n/static/d0bfe0f7c8835cfa903e20ee9249fa7a/efc66/round2-3.png 885w,\n/static/d0bfe0f7c8835cfa903e20ee9249fa7a/c83ae/round2-3.png 1180w,\n/static/d0bfe0f7c8835cfa903e20ee9249fa7a/7edcf/round2-3.png 2995w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>The remaining key that is not discarded to the list of impossible key should be the correct possible key. We just need to repeat this process to the other byte position.</p>\n<p>But, there is still one problem, that is if we only use one $\\alpha$, it is not enough to discard most of the impossible key. From my experiment, single $\\alpha$ will only find about 110-140 impossible keys. So, we need more $\\alpha$ which means more chosen-plaintext pairs. The ideal number of $\\alpha$ required would be about ~10 to discard almost all of the impossible keys.</p>\n<blockquote>\n<p><strong>NOTE</strong>: using two $\\alpha$ doesn’t mean we will find ~250 impossible keys, since most keys found will be duplicate to each other.</p>\n</blockquote>\n<p>After we discard almost all of the impossible keys, we still need to inverse the key from $RK_2$ to $RK_0$ which is the <code class=\"language-text\">MasterKey</code>. How we perform inverse Key Schedule is outside this article scope and will not be explained here. If you want to learn how to do it, you can take a look on my <a href=\"https://github.com/Merricx/aes-attack/blob/main/utils.py#L134\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">source code</a> or probably implement yourself :D</p>\n<p>Finally, we can enumerate the remaining possible key using trial encryption/decryption like our previous attack. This should only take less than $2^{6}$ trials if we use ~10 $\\alpha$.</p>\n<h3 id=\"full-last-round\"><a href=\"#full-last-round\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Full Last Round</h3>\n<p>Now, as we successfully broke 2-round AES with half last round, how will we do it in the full last round?</p>\n<p>If we re-illustrate the attack flow into full round scenario, we need 4-byte guess at once to bypass <code class=\"language-text\">InvMixColumns</code> operation and this alone already significantly increase time complexity from $2^{8}$ to $2^{32}$.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3265c240bb56f05bf40545ba9ce35e79/5f652/round2-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 66.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACWUlEQVR42pVT3WoTURDep/DeB+ibWOiNiPQFvPBCeql3ig+gXhUEQYvSG6HSQKuEQpXW9iLGpiTZ/7/k7HY3u0l2N81umu3nnGMSDCjFgWE5zMw338x8KxVFgSiK0O/3Eccx0jQFt+vra/Hlb9u2RQ7zQ+RXWIpPJhMkaYK5SWEYotFooNVqCdc1GRNqMi/iYGdnPyGrBupHO2CN9yI2nV6JJnEcIfAj1PR91N3Kb8AguIDbYfBcFYmyhSzpLbqrqgrWdWF1+jAOn6KzfVvE8nyMZrMJWWnD0S/w+vABXh3dgeS6Ls4bZ8TAglL/DOvdLUqoY0oTZVkKy7LgsQ688BLd788R7KyADzspchiGQUQcBN0B3nx9iM3je5A8z4Msy1A1A4bagF17C1NrYZwXYhy+Bk2VYbMhlOoTsI8rKAmwKMbQdR3M6yLyM2ydPMLmyV1IjDEB2G4raJ7/AGvtIr/sz/Y0FUUcUDEu0Ko+Q/hpRcQKGpnXOY4FW/Px4fgxMbwPaTQaYTgcIkkSunSErO/SOOMFYJZlSCm2t/8FtlpDbH1DNhqL6/OjcNc0HYMsQJR2IOEfNpcFNw5aqezCdGi8vEQQBujRMQeDgXAut4VseOGylwswzpAzCYMAOh0vJnkNXr7AdCarP60UdeXfGc4B56I3aY8OMWIHB/BXVzHq9cRhuKx4Dm88r7sR0Pd9qIoCmQRuVatw19fR63Zh0tt1HNqfJoD/C1Am6dTbbeh7e+isrSEjhjyjJGZlWS7V3AjI/ySDRm6bJvzTUzgbGxiTKmaJS/n8+wtP/cVhbJNP/QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round2 4\"\n        title=\"\"\n        src=\"/static/3265c240bb56f05bf40545ba9ce35e79/fcda8/round2-4.png\"\n        srcset=\"/static/3265c240bb56f05bf40545ba9ce35e79/12f09/round2-4.png 148w,\n/static/3265c240bb56f05bf40545ba9ce35e79/e4a3f/round2-4.png 295w,\n/static/3265c240bb56f05bf40545ba9ce35e79/fcda8/round2-4.png 590w,\n/static/3265c240bb56f05bf40545ba9ce35e79/efc66/round2-4.png 885w,\n/static/3265c240bb56f05bf40545ba9ce35e79/c83ae/round2-4.png 1180w,\n/static/3265c240bb56f05bf40545ba9ce35e79/5f652/round2-4.png 1302w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Fortunately, there is one property in AES to overcome this problem. Remember that both of <code class=\"language-text\">MixColumns</code> and <code class=\"language-text\">AddRoundKey</code> are linear operation and these operation hold the following equation:</p>\n$$\n\\begin{equation}\n\\begin{aligned}\nARK(MC(p)) & = MC(p) \\oplus RoundKey \\\\\n& = MC(p) \\oplus MC(MC^{-1}(RoundKey)) \\\\\n& = MC(p \\oplus MC^{-1}(RoundKey)) \\\\\n\\end{aligned}\n\\end{equation}\n$$\n<p>Which means we can swap the order operation of <code class=\"language-text\">MixColumns</code> with <code class=\"language-text\">AddRoundKey</code> as well as <code class=\"language-text\">AddRoundKey</code> with <code class=\"language-text\">InvMixColumns</code>.</p>\n$$\n\\begin{equation}\n\\begin{aligned}\nMC^{-1}(ARK(c)) = MC^{-1}(c) \\oplus MC^{-1}(RoundKey)\n\\end{aligned}\n\\end{equation}\n$$\n<p>So, we can apply $MC^{-1}$ on our $c$ before $ARK$ as long as we also apply $MC^{-1}$ to the $RK_2$. But, we don’t really care about updating $RK_2$ right now. We just need to apply $MC$ later when we got all bytes of the possible keys.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3de192a96ca7edecdee7444096225c50/f7171/round2-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 45.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzklEQVR42k2SW2+cMBCF+fd96J/oc/vQl1bqe5S2SZWqTTbZkIWFBRYvNjdzv5+ODY0yEhoP4PF3ztjI8hans4QsGizLQg90VlEWORgLdZ1lCYQQGMYR58BHXUkURQl2CTFOA8qyBJcnGDszw4dPD3g+RLrJPK/NVDDrGtZhjywV8M0rOI6DKBKwXx6Q+He0TnFv/gCLXRxtB1/+vodRVUQYZMhlSy3WZuPYa9KCCBVV13XIiTBNU7RtC8uyEKcJOBekgGEYBr22ozsYyzJvPAs1GpBmDfZmoCV2XU85w9tQkl3LRvi0R5Ik6Pse8zQhocNSj8GYqJimGSo3dYULyXjcOwjDM6QkQs7X4+ZJ56qu4RwOYOYzWiKvqVbUrufB/q0J1x/XgWySh14foNgVJTYzts84Oi5EXpAlBdqm0e+UEkE2GAGrcHV7RsByhbFu2nYK8xYvT/fkXYJwdw3XOYKLmIayBzd/IWIXfH/8A5OTmgvHu5uvME5Bgc/fLJi20ByadF59jZlP07PQEEUUOPBJlpQS3slFxkPkeQ7H95DXJWSc4uPuJ4yafIsiru/Uf8mv0slb1UDV/TBqiSqkLND1g55uRfdP+aEsAl25fwqvquRIA5MMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round2 5\"\n        title=\"\"\n        src=\"/static/3de192a96ca7edecdee7444096225c50/fcda8/round2-5.png\"\n        srcset=\"/static/3de192a96ca7edecdee7444096225c50/12f09/round2-5.png 148w,\n/static/3de192a96ca7edecdee7444096225c50/e4a3f/round2-5.png 295w,\n/static/3de192a96ca7edecdee7444096225c50/fcda8/round2-5.png 590w,\n/static/3de192a96ca7edecdee7444096225c50/efc66/round2-5.png 885w,\n/static/3de192a96ca7edecdee7444096225c50/c83ae/round2-5.png 1180w,\n/static/3de192a96ca7edecdee7444096225c50/f7171/round2-5.png 3456w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Thats it! There is no other difference with how we attack half round.</p>\n<h1 id=\"3-round-aes\"><a href=\"#3-round-aes\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3 Round AES</h1>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b7cdc09b99fde544b9e43876dfb13668/efa1a/round3-0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 68.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlElEQVR42p3TSY5CMQwE0Nz/eGxBzNNnnkeB6WcpLHrX/SXjJLaryk4oj8cj1ut1LJfL9Pv9Po7HYzyfzxBj1r9ttVrFdDqNwWAQs9ksNptN3O/3KIKn0ymBmqZJAMnn8zntcrl87Xq9pkfY7/cTZD6fx3a7zZrxeByFqslkkgm9Xi8ZD4dD7Ha7JOEBMOc8AYwyKpkOxYtDDJiYguFw+GVEaL1YLHLNI9GN9Wg0SjBqdVCoEwRMIcBWq5Xq7CWKIVEon5J2u53K5AAF3u12o2BTIJEiLQMBYG8UtS0xxc6A851OJ029TovE2+2WFwDcWmvkS6C03ry5icmlyJm9PLV5ywC1jBGTJF4SlWJma13PFGsPKNXOdGldzEOBDV9nxEuqZMZQyXnEdab2ahHlLWtFgiLvDLO26lOgTGs1R0ydmBcAyLk3XTDaKHBjknnA9WYZALOs6rSszsU5Q+pPUeLncxFUAuNfr9d3zVwQdmf132LPGxVRYu/3O4qf/3zAtEyhOeowb1kQ6F/MR6nZGYc51pY/Pm4lobAgxCcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round3 0\"\n        title=\"\"\n        src=\"/static/b7cdc09b99fde544b9e43876dfb13668/fcda8/round3-0.png\"\n        srcset=\"/static/b7cdc09b99fde544b9e43876dfb13668/12f09/round3-0.png 148w,\n/static/b7cdc09b99fde544b9e43876dfb13668/e4a3f/round3-0.png 295w,\n/static/b7cdc09b99fde544b9e43876dfb13668/fcda8/round3-0.png 590w,\n/static/b7cdc09b99fde544b9e43876dfb13668/efc66/round3-0.png 885w,\n/static/b7cdc09b99fde544b9e43876dfb13668/c83ae/round3-0.png 1180w,\n/static/b7cdc09b99fde544b9e43876dfb13668/efa1a/round3-0.png 2040w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Good news! We can actually extend our previous attack to work against 3-round AES. We can think this as “2-round AES with additional round at the beginning”.</p>\n<p>Let $\\alpha$ be differential of plaintext $(p_1, p_2)$ where only the <strong>first</strong> byte has active byte, the rest are inactive. If we illustrate this state and go through first round transformation, the state will end up exactly as the state in the first round of 2-round attack.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2fe969fa59e2aed2932e632035b17f88/6fc98/round3-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 45.94594594594595%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqUlEQVR42oWSS2/TUBCF/Zf5AyzZsewCsUFIIAQSqy4QCKrCghRQQ7tASUniR/xI7MSOH0munx9z3UaKUBEjzWLmzpxz5ugaHEVaKVZFhtrv+7qkZRoFmLMZeZ73PSePGU8nhMsldJDLzo1r47seu90OYy/LeXE7fDr5yZsfn3EmArBJGa8DTr6+wzVtXN+jqSqeXp0zuB7i2DZULS9GFzz88pbEDQhXK4woigiCgKZpSJONDDpYlkUcx2ySBMe0sGXZdd1eZegHjEcjJrMpqJonwzMefHzJypwTiGrj+ORMFnzfx/M8tqK8LEtMAbclD6SaSBMuQzm5bvkWWrz6NWCzjCi2W4yu62jbtgdsxAO1XrNxHLLFgr1SaEsOqaTWJHVdU969qd1ttoKjo1fYw0n9+vKM55fn2OPfRPO5nKT4X5hJyIV9QyGep1mG4Yk37iKAJOfx8D2PBqfEc59IDO6KQvOgr7gvdeTbAk/siNcxiXhuaPmqrvrHZ8NPnHz/wMJ2CQOfThQeAP+OQ69UJbko0+f33+Z4qBZFOlsxt05Tujtv7wP8V/8P+iGqq4YtpjEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round3 1\"\n        title=\"\"\n        src=\"/static/2fe969fa59e2aed2932e632035b17f88/fcda8/round3-1.png\"\n        srcset=\"/static/2fe969fa59e2aed2932e632035b17f88/12f09/round3-1.png 148w,\n/static/2fe969fa59e2aed2932e632035b17f88/e4a3f/round3-1.png 295w,\n/static/2fe969fa59e2aed2932e632035b17f88/fcda8/round3-1.png 590w,\n/static/2fe969fa59e2aed2932e632035b17f88/efc66/round3-1.png 885w,\n/static/2fe969fa59e2aed2932e632035b17f88/c83ae/round3-1.png 1180w,\n/static/2fe969fa59e2aed2932e632035b17f88/6fc98/round3-1.png 2161w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Okay, so the only problem now is how can we bypass this <code class=\"language-text\">SubBytes</code> in the first round?</p>\n<p>We can guess one byte of $RK_0$ for every possible values denoted by $GK_0$ and then apply 1 round transformation to the plaintext $(p_1, p_2)$ through $ARK$, $SB$, $SR$, and $MC$ independently (note that we apply $ARK$ of round 0, instead of round 1). After that, we create differential of transformed $(p_1, p_2)$ denoted by $\\alpha$ and finally we are in the same situation as the previous 2-round attack.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4233894c210027914dd18b6c83b4910e/65c7e/round3-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0ElEQVR42lVSzW6bQBjkPfsIfYn0DXrpG/QSqadIzaGS1UOatqnkqKnTggkYAmYBwwI1YGAxO/12Y8fpSivtzzezszOfka9mYIyh73sAEschqiXWD98RJxkmOm7jb3CsnyjKmsp6JPYnBGGIpml0vZRST8OaX8CyTGw2GYQQ4DzHICYw7xbW3RXCNUPOC0TONcz7W/hhgm3mwLp4BXe1QpZlJOMkxGAJRxRFaNsWchxR1zWmacK26UgBQ5qm2O12qLYdPM9HuuGY+hzh1zcaV1aVJhpJjMIZQgyY9nvUBIpnM4S2jTTPSf50+MbhaXlSoQkI05AINT48zHGzvEeZcxjHAsXOyBPLNPEYBM9AxSNfkB3X4yjAkoSAwOurc3z8dYNtXsDoenkokugoGM45GV1DjCAv5XNQO6ob96e9EHu6H/T60l9g7pj4WxDh5ecAvv+Iqir1ZdM8fWNhFbj+4YHnKYa+xZd5gcVvD1WZkZ8j3r13qTti8rA8qVehuK5LZnuI41i3jlI4DALROoRtLzWoKEqkCaO9jSSJwNItzt4uEAQhpbzRRPLJGxgVpaT6UCX5n+mUeBQxnaTyt+t6OI5LinPt692fTBOqrnjZh/8AyvWouzl5bEIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"round3 2\"\n        title=\"\"\n        src=\"/static/4233894c210027914dd18b6c83b4910e/fcda8/round3-2.png\"\n        srcset=\"/static/4233894c210027914dd18b6c83b4910e/12f09/round3-2.png 148w,\n/static/4233894c210027914dd18b6c83b4910e/e4a3f/round3-2.png 295w,\n/static/4233894c210027914dd18b6c83b4910e/fcda8/round3-2.png 590w,\n/static/4233894c210027914dd18b6c83b4910e/efc66/round3-2.png 885w,\n/static/4233894c210027914dd18b6c83b4910e/c83ae/round3-2.png 1180w,\n/static/4233894c210027914dd18b6c83b4910e/65c7e/round3-2.png 2577w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>From here, the flow is relatively same as 2-round attack where we generate bunch of impossible state from $\\alpha$ through second round resulting the list of impossible state.</p>\n<p>Then, we guess another one byte of $RK_3$ denoted by $GK_3$, inverse pair of ciphertext $(c_1, c_2)$ in the third round through $MC^{-1}$, $ARK$, $SR^{-1}$, $SB^{-1}$ independently and create differential from those pair denoted by $\\beta$. Compare $\\beta$ with the impossible state, if $\\beta$ exist in one of the impossible state, we add $GK_3$ to the list of impossible key. </p>\n<p>We can determine whether $GK_0$ is the correct guess or not by looking at the number of $GK_3$ that added to the impossible keys. If in any byte position, impossible keys contain all possible bytes, then $GK_0$ is incorrect, otherwise $GK_0$ is correct.</p>\n<p>After impossible keys of all byte position in $RK_3$ discarded, we enumerate the remaining key, apply $MC$ and perform inverse key schedule to reverse $RK_3$ to $RK_0$ and check if the key is correct via trial encryption/decryption.</p>\n<p>Although the chosen-plaintext required in this attack is the same with the previous attack (~10 $\\alpha$), the time complexity in this attack is at least $2^8$ times higher than the previous attack since we guess 2 bytes at a time. Moreover, for each guess of $GK_0$, we need to regenerate the impossible state again. But this attack is still quite fast and running this on my laptop only take less than 5 minutes on average.</p>\n<h1 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h1>\n<p>That’s all, we successfully broke 1-round AES until 3-round AES with differential cryptanalysis. We start ourselves looking at the differential property of AES S-Box and then able to exploit those property to recover the key round by round. </p>\n<p>Although there are many of more sophisticated and more advanced attacks on higher round, AES is still remain secure in full round. </p>\n<p>Lastly, all python implementation of these attacks can be found <a href=\"https://github.com/Merricx/aes-attack\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>.</p>\n<h1 id=\"references\"><a href=\"#references\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h1>\n<ol>\n<li>\n<p>Daemen, J. &#x26; Rijmen, V. (1998). AES Proposal: Rijndael, NIST AES proposal.</p>\n</li>\n<li>\n<p>Bouillaguet, C., Derbez, P., Dunkelman, O., Keller, N., Rijmen, V., &#x26; Fouque, P.-A. (2010). Low Data Complexity Attacks on AES. Cryptology ePrint Archive, Paper 2010/633. <a href=\"https://eprint.iacr.org/2010/633\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://eprint.iacr.org/2010/633</a></p>\n</li>\n</ol>","timeToRead":19,"frontmatter":{"title":"The Adventure of Attacking AES","date":"April 16, 2023","spoiler":"How to practically break reduced-round AES from 1 round until 3 round","cta":"aes"},"fields":{"slug":"/adventure-of-aes/","langKey":"en"}}},"pageContext":{"slug":"/adventure-of-aes/","previous":{"fields":{"slug":"/dont-roll-your-own-crypto-1/","langKey":"en","directoryName":"dont-roll-your-own-crypto-1","maybeAbsoluteLinks":""},"frontmatter":{"title":"Don't Roll Your Own Crypto #1"}},"next":null,"translations":[],"translatedLinks":[]}},"staticQueryHashes":["336482444"]}