{"componentChunkName":"component---src-templates-blog-post-js","path":"/dont-roll-your-own-crypto-1/","result":{"data":{"site":{"siteMetadata":{"title":"Merricx","author":"merricx"}},"markdownRemark":{"id":"d4721f00-f4df-5047-a264-e58a12b081a8","html":"<h1 id=\"introduction\"><a href=\"#introduction\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h1>\n<p>This is a series where I will try to reviewing and cryptanalyzing various cryptosystem schemes that proposed in academic journal, paper, and article from Universities in Indonesia.</p>\n<p>As written in the title, this article tries to emphasize the sentence “Don’t roll your own Crypto”, where we can’t just design or create our own cryptosystem algorithm. We should always use standarized algorithm for Cryptography. </p>\n<p>There’s absolutely no intention or whatsoever about humiliating the research that discussed here. In fact, this is how the process of proposing a cryptosystem scheme is carried out, where some party proposes an idea, and the other parties will try to find the weaknesses of that idea, until finally from these weaknesses, it can be developed into a better scheme and so on. </p>\n<h1 id=\"chaos-based-image-encryption\"><a href=\"#chaos-based-image-encryption\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Chaos-based Image Encryption</h1>\n<p>Cryptosystem that will be discussed in this first series is the study from article entitled <strong>“ANALISIS KEAMANAN ALGORITMA ENKRIPSI CITRA DIGITAL MENGGUNAKAN KOMBINASI DUA CHAOS MAP DAN PENERAPAN TEKNIK SELEKTIF”</strong> written by Rinaldi Munir, that published on Jurnal Ilmiah Teknologi Informasi (JUTI) in 2012 <sup><a href=\"#references\">[1]</a></sup>.</p>\n<p>The article discussed about image encryption by using two Chaos-based function, which is <strong>Arnold’s Cat Map</strong> as permutation and <strong>Logistic Map</strong> as keystream generator.</p>\n<p>In addition, the article also explained the use of “selective encryption” where the encryption only done on the first 4-bit (Most Significant Byte), while the last 4-bit (Least Significant Byte) of the image (after permutation) never change.</p>\n<h2 id=\"arnolds-cat-map\"><a href=\"#arnolds-cat-map\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Arnold’s Cat Map</h2>\n<p>Arnold’s Cat Map is Chaos Map function that shuffle pixels position (in <code class=\"language-text\">(x,y)</code> coordinate) of the image.</p>\n<p>The equation that used in the article is as follows.</p>\n$$\n    \\begin{bmatrix}\n    x' \\\\\n    y' \\\\\n    \\end{bmatrix}\n    =\n    \\begin{bmatrix}\n    1 & p \\\\\n    q & pq + 1 \\\\\n    \\end{bmatrix}\n    \\begin{bmatrix}\n    x \\\\\n    y \\\\\n    \\end{bmatrix}\n    \\mod N\n$$\n<p>Where <code class=\"language-text\">(x,y)</code> is the inital position and <code class=\"language-text\">(x&#39;, y&#39;)</code> is the position after permutation. Meanwhile, <code class=\"language-text\">N</code> is the size of the image and this function will be iterated <code class=\"language-text\">m</code> times.</p>\n<p>So, the secret variables in this ACM function consists of <code class=\"language-text\">p</code>, <code class=\"language-text\">q</code>, and <code class=\"language-text\">m</code>.</p>\n<p>The following is the visualization of the image after ACM has been performed several times. It can be seen that the higher the <code class=\"language-text\">m</code> value, the more random-looking the result will be.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/53cb714c13290142b14c7a0db1ebbb9d/9cab2/acm.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 76.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAACnUlEQVQoz2WSa1MSYRTH/QjN9B36Hr6uVzXTOPYCFbnswi67ywLLbbkooFgpjVqSCZY6Y1njtcuMTBOIQaKmASY1UynS1JBBGEWy0IFFEzuz++wzzzm/c/Y5/9PAccVyuRwPz4/YBV5H6/SwbdztnvH2RhbvlKs21NtFtDUZCTFLSAyEWIMIYhvrcM5xXAO8sAst+awqsWfAOTHiNlA0Q9KRZT8Pe2+69Liok8EdetLG4CyFxN+8roN9vgCGkBSKMkiT+NL5c2fPKJF2HvYM9jIyYacG62QUNq1CrxBtRTfr4ID/lQylVaRJg0l7WKzl4gXPoOtfZUxo0xJ2eHSESYlux47gYrECzy/4GhubBc1SLUk5zUq1TPL8ySMeHrhqx1suG3ChmUK08lZKdCW2sVaDS6US7HZ2k7Nzi6Oeibnp6YWZqafzc19Sn3h4Ox5dDQeDL3y+Z4/XV5bXwsHs9304B7Ch+qkE/crn3iXeJnd3YtHoXnKXv06lQvGwxHHpdDr1OXVYtVKp5qrdeSMS7jLQ/d0Wl93U77Q4WfXs/XE+YtLrtuuoPrvRZTdes2q7japEPFrXsJVlPyNrZSmpkZSAGGpEAMxRt69r5W1mGoVzWKHbp3VeDS0ZCQmI2VGVxKAQTY3VhmT0lsugEHdoFFY1Bt6Kzpv1OkdCSwCAz6qSd2hwHdb+4O7wkVR9erzdqsYtKjnwLCmNb9ZXjrwMaDGhmZZBYotKxsjbJkdvn4SBNCtRWOEHT8NroSCkdOjIHlbt0FMQ8XBshIfvDd2ARnSzdJdBCaNiotGt4/HkIwqF39nM/rf015VwaOfjh1w28/Mgx7sOcj9A2PeJ7WDAn9pLgutPoVCTqnzCIFkmkwUly/9ZPp/P5XLH4vP2FzUBl+7GsUYWAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"acm\"\n        title=\"\"\n        src=\"/static/53cb714c13290142b14c7a0db1ebbb9d/fcda8/acm.png\"\n        srcset=\"/static/53cb714c13290142b14c7a0db1ebbb9d/12f09/acm.png 148w,\n/static/53cb714c13290142b14c7a0db1ebbb9d/e4a3f/acm.png 295w,\n/static/53cb714c13290142b14c7a0db1ebbb9d/fcda8/acm.png 590w,\n/static/53cb714c13290142b14c7a0db1ebbb9d/9cab2/acm.png 864w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>To inverse this process, just multiply <code class=\"language-text\">(x&#39;, y&#39;)</code> with the inverse matrix of $\\begin{bmatrix} 1 & p\\\\ q & pq+1\\\\ \\end{bmatrix}$.</p>\n<h2 id=\"logistic-map\"><a href=\"#logistic-map\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Logistic Map</h2>\n<p>Logistic Map is Chaos Map function from simple non-linear equation below.</p>\n$$\nx_{i+1} = r x_i \\left(1 - x_i\\right)\n$$\n<p>Where defined constant <code class=\"language-text\">r</code> as real number in the interval of 0 to 4 and <code class=\"language-text\">x0</code> as random initial value in the interval of 0 to 1. These variables are kept secret.</p>\n<p>To generate keystream with Logistic Map, calculate the above equation which will be resulting <code class=\"language-text\">x1, x2, x3, ...</code> until the required length of keystream is met. Each value of <code class=\"language-text\">x1, x2, x3, ...</code> then will be represented as 4-bit key which is determined from the numbers after decimal point.</p>\n<p>For example, given a sequence of Logistic Map that is <code class=\"language-text\">0.5, 0.875, 0.3828125, 0.8269348, ...</code>, then we take the number after decimal point (with pre-defined precision, 4 in this case) so they become <code class=\"language-text\">5, 875, 3828, 8269, ...</code>. Change each of the number to binary and take the last 4-bit (LSB) resulting keystream as follows: <code class=\"language-text\">0101, 1011, 0100, 1101, ...</code></p>\n<h2 id=\"encryption\"><a href=\"#encryption\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Encryption</h2>\n<p>The encryption stages are as follows:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0542cfc5a2b3327fcba64f6f6a9bd4c2/c1b63/encrypt.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhklEQVQoz5WQ60vCUBjG/Qv7BwwiiCjWhYjaUhdkISSBqIuiErGrWwUGfqkECQpJIQLJb6ngdLqt4aZzXrfemi3z8qHnwznbed/feZ/nmFRV1TTtLR6+DTrvQuTrU1jttLQe6Q3xxwfq+Oj6zH8fDhklk167udj32uccFtTn3gZYqdc5jq18q9lsdjqdc9/e8rQZRSZdW7Z+OOAPIlOziHkMmRiXZVmSpGKxyLKsIAgVSSoUGDJwaJ2fwpdmdp32AThwtYCsuhzrl6c+7a+61siTTWxxZ2PtwO38hfVNrtVYlmNLJZhpAL3wB89nMxlRLKfT7/2woUajkc/nc7kcGBaht1yG2BAkR9O8IMBFiqIMgfUJ7XYbeIZhAIBveC1YoSCLosTz8MtxnNFsGpoQzAPTe5JNpV4ikVgsFo1GR9qGu4UfVatVcKGfkxS1gmJWi4UgiJEwDISxEAyiwtpqtfTJFEVhKGbDbR6PZyQ8qC5MfsE4jhOE998wnaef4/FEIpFMJo3SJ8nEheLM5TteAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"encrypt\"\n        title=\"\"\n        src=\"/static/0542cfc5a2b3327fcba64f6f6a9bd4c2/fcda8/encrypt.png\"\n        srcset=\"/static/0542cfc5a2b3327fcba64f6f6a9bd4c2/12f09/encrypt.png 148w,\n/static/0542cfc5a2b3327fcba64f6f6a9bd4c2/e4a3f/encrypt.png 295w,\n/static/0542cfc5a2b3327fcba64f6f6a9bd4c2/fcda8/encrypt.png 590w,\n/static/0542cfc5a2b3327fcba64f6f6a9bd4c2/efc66/encrypt.png 885w,\n/static/0542cfc5a2b3327fcba64f6f6a9bd4c2/c83ae/encrypt.png 1180w,\n/static/0542cfc5a2b3327fcba64f6f6a9bd4c2/c1b63/encrypt.png 1200w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ol>\n<li>Define Plain-image <code class=\"language-text\">P</code>, secret key <code class=\"language-text\">p</code>, <code class=\"language-text\">q</code>, <code class=\"language-text\">m</code>, <code class=\"language-text\">r</code>, and <code class=\"language-text\">x0</code>.</li>\n<li>Permutate image <code class=\"language-text\">P</code> using Arnold’s Cat Map with <code class=\"language-text\">p</code>, <code class=\"language-text\">q</code>, and <code class=\"language-text\">m</code> as parameters, resulting image <code class=\"language-text\">Px</code>.</li>\n<li>Generate keystream <code class=\"language-text\">K</code> using Logistic Map with constant <code class=\"language-text\">r</code> and inital value <code class=\"language-text\">x0</code>.</li>\n<li>Encrypt 4-bit MSB each pixel of image <code class=\"language-text\">Px</code> with keystream <code class=\"language-text\">K</code> using XOR operation, resulting 4-bit <code class=\"language-text\">Cx</code> on each pixel.</li>\n<li>Combine 4-bit <code class=\"language-text\">Cx</code> with 4-bit LSB of image <code class=\"language-text\">Px</code> on each pixel, resulting Cipher-image <code class=\"language-text\">C</code></li>\n</ol>\n<p>Implementation of this algorithm can be accessed in <a href=\"https://github.com/Merricx/chaos-image-encryption/blob/main/encryption.py\" target=\"_blank\">this link</a>.</p>\n<h1 id=\"cryptanalysis\"><a href=\"#cryptanalysis\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cryptanalysis</h1>\n<p>Let’s just try to do the cryptanalysis against this encryption scheme.</p>\n<p>While conducting cryptanalysis, will be assumed some implementation scenario because the article didn’t define a specification of how the implementation should be done.</p>\n<p>Cryptanalysis model which we will use is <strong>Chosen-Plain image Attack</strong>, where we can encrypt any image as much as we want and receive the coresponding cipher image.</p>\n<h2 id=\"static-secret-key\"><a href=\"#static-secret-key\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Static Secret Key</h2>\n<p>Let’s assume the implementation where secret key that consist of <code class=\"language-text\">p</code>, <code class=\"language-text\">q</code>, <code class=\"language-text\">m</code>, <code class=\"language-text\">r</code>, and <code class=\"language-text\">x0</code> are static and does not change in different encryption request.</p>\n<h3 id=\"recovery-of-keystream\"><a href=\"#recovery-of-keystream\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recovery of Keystream</h3>\n<p>Because the value of <code class=\"language-text\">r</code> and <code class=\"language-text\">x0</code> always same, the result keystream generated from Logistic Map will also be same.</p>\n<p>That means, we can determine keystream <code class=\"language-text\">K</code> easily as long as we know cipher image <code class=\"language-text\">C</code> and the coresponding plain image that has been permutated by ACM (<code class=\"language-text\">Px</code>) because:</p>\n$$\nC = Px \\oplus K \\\\\nK = C \\oplus Px\n$$\n<p>But, here we still don’t know the value of <code class=\"language-text\">Px</code> (only 4-bit LSB that we know) because we don’t know value of <code class=\"language-text\">p</code>, <code class=\"language-text\">q</code>, and <code class=\"language-text\">m</code> of ACM.</p>\n<p>Well, because this is Chosen-Plain image Attack and we can encrypt any image, we can just use plain image where all of the pixels are same such as full-black image or full-white image.</p>\n<p>Because all of the pixels are same, the permutation from ACM will resulting same image too, so that we know <code class=\"language-text\">Px</code> and we can just find the keystream with XOR ¯\\_(ツ)_/¯</p>\n<p>After we got the keystream, let’s find <code class=\"language-text\">p</code>, <code class=\"language-text\">q</code>, and <code class=\"language-text\">m</code>.</p>\n<h3 id=\"recovery-of-m\"><a href=\"#recovery-of-m\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recovery of <code class=\"language-text\">m</code></h3>\n<p>It should be noted that ACM process is actually quite costly in terms of hardware, where in one ACM iteration (<code class=\"language-text\">m = 1</code>) takes quite long time to finish, so the time difference in the value of <code class=\"language-text\">m</code> and <code class=\"language-text\">m+1</code> is quite noticable.</p>\n<p>This is actually dangerous because we can find out the value of <code class=\"language-text\">m</code> from <strong>Timing Attack</strong>. The higher the <code class=\"language-text\">m</code> value is, the longer the ACM operation will take.</p>\n<p>The following is table of test results for the time required for the ACM process using <code class=\"language-text\">m = 1</code> to <code class=\"language-text\">m = 5</code> on a 1024x1024 image using my own laptop.</p>\n<table>\n<thead>\n<tr>\n<th>m</th>\n<th>Time (s)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>7.1236</td>\n</tr>\n<tr>\n<td>2</td>\n<td>13.8878</td>\n</tr>\n<tr>\n<td>3</td>\n<td>21.7516</td>\n</tr>\n<tr>\n<td>4</td>\n<td>27.8001</td>\n</tr>\n<tr>\n<td>5</td>\n<td>35.2292</td>\n</tr>\n</tbody>\n</table>\n<p>It can be seen on the table that time required for the ACM is relatively consistent on the multiple of 7 seconds. From this time result, we can find <code class=\"language-text\">m</code> only from the time it takes to encrypt an image.</p>\n<p>Actually from the start, keeping <code class=\"language-text\">m</code> secret is irrelevant, because after all, it is impossible that the value <code class=\"language-text\">m</code> would be too high, since it can bring performance issue if the value of <code class=\"language-text\">m</code> is too high. So, we can also just brute-force <code class=\"language-text\">m</code>.</p>\n<h3 id=\"recovery-of-p-and-q\"><a href=\"#recovery-of-p-and-q\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recovery of <code class=\"language-text\">p</code> and <code class=\"language-text\">q</code></h3>\n<p>After getting the value of <code class=\"language-text\">m</code>, finding <code class=\"language-text\">p</code> and <code class=\"language-text\">q</code> is trivial.</p>\n<p>The idea is that we will create plain image where all of the pixels contain value of black color (0), except for one pixel that will be white colored (255) or value other than 0.</p>\n<p>For example, we specify the white pixel on <code class=\"language-text\">(1, 0)</code>, then plain image with 4x4 size can be represented as the following matrix.</p>\n$$\n\\begin{pmatrix}\n0 & 255 & 0 & 0 \\\\\n0 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 0 \\\\\n\\end{pmatrix}\n$$\n<p>Enter the plain image into encryption oracle, get the corresponding cipher image, then decrypt it using keystream that we got before, so we have permutated plain-image.</p>\n<p>Lets assume the permutated plain image is as follows.</p>\n$$\n\\begin{pmatrix}\n0 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 0 \\\\\n0 & 0 & 255 & 0 \\\\\n\\end{pmatrix}\n$$\n<p>Then, we can conclude that our previous pixel on <code class=\"language-text\">(1, 0)</code> move to <code class=\"language-text\">(2, 3)</code>.</p>\n<p>Lets assume <code class=\"language-text\">m = 3</code>, then the equation of ACM will be as follows.</p>\n$$\n    \\begin{bmatrix}\n    2 \\\\\n    3 \\\\\n    \\end{bmatrix}\n    =\n    \\begin{bmatrix}\n    1 & p \\\\\n    q & pq + 1 \\\\\n    \\end{bmatrix}^3\n    \\begin{bmatrix}\n    1 \\\\\n    0 \\\\\n    \\end{bmatrix}\n    \\mod N\n$$\n<p>It can be rewritten to:</p>\n$$\n\\begin{equation}\n\\begin{aligned}\n2 &\\equiv \\left( \\left( p \\cdot q + 1 \\right) \\cdot p + p \\right) \\cdot q + p \\cdot q + 1 \\pmod{N} \\\\ \n3 &\\equiv \\left( \\left( p \\cdot q + 1 \\right)^2 + p \\cdot q \\right) \\cdot q + \\left( p \\cdot q + 1 \\right) \\cdot q + q \\pmod{N}\n\\end{aligned}\n\\end{equation}\n$$\n<p>Where <code class=\"language-text\">p</code> and <code class=\"language-text\">q</code> can be found by solving linear equations in two variables (with modulus <code class=\"language-text\">N</code>).</p>\n<p>Finally, with the knowledge of keystream <code class=\"language-text\">K</code>, secret value <code class=\"language-text\">p</code>, <code class=\"language-text\">q</code>, and <code class=\"language-text\">m</code>, we can decrypt any image that was encrypted under this secret key :).</p>\n<h3 id=\"proof-of-concept\"><a href=\"#proof-of-concept\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Lets prove it by implementing it into Python.</p>\n<p>First, we define <code class=\"language-text\">encryption_oracle()</code> function which will be acting as a “server” where we can encrypt any image to that “server” and receive the corresponding cipher image.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> random<span class=\"token punctuation\">,</span> os\n<span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np\n<span class=\"token keyword\">import</span> encryption\n<span class=\"token keyword\">from</span> PIL <span class=\"token keyword\">import</span> Image\n<span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>strxor <span class=\"token keyword\">import</span> strxor\n\n<span class=\"token comment\"># Secret</span>\np <span class=\"token operator\">=</span> random<span class=\"token punctuation\">.</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">250</span><span class=\"token punctuation\">)</span>\nq <span class=\"token operator\">=</span> random<span class=\"token punctuation\">.</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">250</span><span class=\"token punctuation\">)</span>\nm <span class=\"token operator\">=</span> <span class=\"token number\">3</span>\ninit <span class=\"token operator\">=</span> random<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nr <span class=\"token operator\">=</span> <span class=\"token number\">3</span> <span class=\"token operator\">+</span> random<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">encryption_oracle</span><span class=\"token punctuation\">(</span>plain_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">return</span> encryption<span class=\"token punctuation\">.</span>encrypt<span class=\"token punctuation\">(</span>plain_image<span class=\"token punctuation\">,</span> p<span class=\"token punctuation\">,</span> q<span class=\"token punctuation\">,</span> m<span class=\"token punctuation\">,</span> init<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Then, write function to find keystream from chosen-plain image attack.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">recover_keystream</span><span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token comment\"># Generate full-black image</span>\n    plain_image <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span><span class=\"token string\">\"RGB\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>size<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Send image to encryption oracle</span>\n    cipher_image <span class=\"token operator\">=</span> encryption_oracle<span class=\"token punctuation\">(</span>plain_image<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Convert plain_image and cipher_image to bytes</span>\n    plain_image_bytes <span class=\"token operator\">=</span> <span class=\"token builtin\">bytes</span><span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>plain_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>flatten<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>tolist<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    cipher_image_bytes <span class=\"token operator\">=</span> <span class=\"token builtin\">bytes</span><span class=\"token punctuation\">(</span>np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>cipher_image<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>flatten<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>tolist<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Recover 8-bit keystream</span>\n    k <span class=\"token operator\">=</span> <span class=\"token builtin\">list</span><span class=\"token punctuation\">(</span>strxor<span class=\"token punctuation\">(</span>plain_image_bytes<span class=\"token punctuation\">,</span> cipher_image_bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Get 4-bit MSB keystream</span>\n    keystream <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>size<span class=\"token operator\">**</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        bit_len <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>k<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>bit_length<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> bit_len <span class=\"token operator\">></span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span>\n            msb <span class=\"token operator\">=</span> k<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">>></span> <span class=\"token number\">4</span> <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token operator\">**</span><span class=\"token punctuation\">(</span>bit_len<span class=\"token operator\">-</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            msb <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        \n        keystream<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>msb<span class=\"token punctuation\">)</span>\n    \n\n    <span class=\"token keyword\">return</span> keystream</code></pre></div>\n<p>Then, write function to find <code class=\"language-text\">m</code> through Timing Attack.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">recover_m</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token comment\"># avg. second of one encryption execution time (depends on the machine)</span>\n    one_exec_time <span class=\"token operator\">=</span> <span class=\"token number\">10</span> \n\n    start_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    payload <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span>new<span class=\"token punctuation\">(</span><span class=\"token string\">\"RGB\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    encryption_oracle<span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">)</span>\n\n    end_time <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    elapsed_time <span class=\"token operator\">=</span> end_time <span class=\"token operator\">-</span> start_time\n    m <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>elapsed_time <span class=\"token operator\">//</span> one_exec_time<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\"># Result could be faster or slower</span>\n    possible_m <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>m<span class=\"token punctuation\">,</span> m<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> m<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\n    <span class=\"token keyword\">return</span> possible_m</code></pre></div>\n<p>Lastly, to find <code class=\"language-text\">p</code> and <code class=\"language-text\">q</code>, we will use <strong>Sagemath</strong> with the <code class=\"language-text\">solve_mod()</code> function to solving linear equations in two variables as we discussed earlier.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/env sage</span>\n<span class=\"token keyword\">def</span> <span class=\"token function\">recover_pq</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">,</span> x0<span class=\"token punctuation\">,</span> y0<span class=\"token punctuation\">,</span> x1<span class=\"token punctuation\">,</span> y1<span class=\"token punctuation\">,</span> N<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    var<span class=\"token punctuation\">(</span><span class=\"token string\">'p,q'</span><span class=\"token punctuation\">)</span>\n    xy <span class=\"token operator\">=</span> matrix<span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>x0<span class=\"token punctuation\">,</span>y0<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    A <span class=\"token operator\">=</span> matrix<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>p<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span>q<span class=\"token punctuation\">,</span> p<span class=\"token operator\">*</span>q <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n    pos_result <span class=\"token operator\">=</span> solve_mod<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">(</span>A<span class=\"token operator\">^</span>m <span class=\"token operator\">*</span> xy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> x1<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">(</span>A<span class=\"token operator\">^</span>m <span class=\"token operator\">*</span> xy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> y1\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> N<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> pos_result\n\n<span class=\"token keyword\">if</span> __name__ <span class=\"token operator\">==</span> <span class=\"token string\">\"__main__\"</span><span class=\"token punctuation\">:</span>\n\n    m <span class=\"token operator\">=</span> <span class=\"token number\">7</span> <span class=\"token comment\"># ACM iteration</span>\n    x0 <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n    y0 <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    x1 <span class=\"token operator\">=</span> <span class=\"token number\">489</span> <span class=\"token comment\"># x-coordinate after permutation</span>\n    y2 <span class=\"token operator\">=</span> <span class=\"token number\">396</span> <span class=\"token comment\"># y-coordinate after permutation</span>\n    N <span class=\"token operator\">=</span> <span class=\"token number\">512</span> <span class=\"token comment\"># image size</span>\n\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Possible p,q: \"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>recover_pq<span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">,</span> x0<span class=\"token punctuation\">,</span> y0<span class=\"token punctuation\">,</span> x1<span class=\"token punctuation\">,</span> y2<span class=\"token punctuation\">,</span> N<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Full implementation of this attack can be found in <a href=\"https://github.com/Merricx/chaos-image-encryption\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this link</a>.</p>\n<h2 id=\"static-secret-key-with-dynamic-x0\"><a href=\"#static-secret-key-with-dynamic-x0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Static Secret Key with Dynamic <code class=\"language-text\">x0</code></h2>\n<p>The next implementation scenario is assumed that the variable <code class=\"language-text\">p</code>,<code class=\"language-text\">q</code>,<code class=\"language-text\">m</code>,<code class=\"language-text\">r</code> is static but the variable <code class=\"language-text\">x0</code> is dynamic, where this value will change randomly in different encryption request.</p>\n<p>This is the most ideal scenario that can possibly implemented in this scheme, because static keystream is no longer happened.</p>\n<p>However, the problem is how this <code class=\"language-text\">x0</code> can be associated in each of different images. One possible approach is to treat <code class=\"language-text\">x0</code> as Initialization Vector (IV) as we seen in block cipher. But, this value must still be encrypted again with certain method and listed in every image that has been encrypted using that value.</p>\n<p>Let’s ignore the technical side of how <code class=\"language-text\">x0</code> implemented. Our assumption in this scenario is that for every request to the encryption oracle, the value of <code class=\"language-text\">x0</code> will be arbitrary and random.</p>\n<p>Because repeated keystream can no longer be exploited, it will be difficult for us to finding the keystream from chosen-plain image attack, since this encryption basically becomes <strong>One-Time Pad</strong>. </p>\n<h3 id=\"recover-acm-secret\"><a href=\"#recover-acm-secret\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Recover ACM secret</h3>\n<p>Then how can we find <code class=\"language-text\">p</code> and <code class=\"language-text\">q</code> without knowing the <em>keystream</em> that currently used? </p>\n<p>This is where the security flaw from the use of <strong>“selective encryption”</strong> occurs, where cipher image leaks information from the LSB of the plain image. </p>\n<p>Lets assume we use plain image that represented as follows:</p>\n$$\n\\begin{pmatrix}\n0 & 255 & 0 & 0 \\\\\n0 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 0 \\\\\n0 & 0 & 0 & 0 \\\\\n\\end{pmatrix}\n$$\n<p>Enter the plain image into encryption oracle. Then, suppose we get cipher image as follows.</p>\n$$\n\\begin{pmatrix}\n32 & 96 & 176 & 32 \\\\\n112 & 240 & 112 & 144 \\\\\n32 & 95 & 192 & 80 \\\\\n176 & 208 & 48 & 160 \\\\\n\\end{pmatrix}\n$$\n<p>Lets change each of the pixel to binary representation and boom!! <em>LSB oracle goes brrrr!</em></p>\n$$\n\\begin{pmatrix}\n00100000 & 01100000 & 10110000 & 00100000 \\\\\n01110000 & 11110000 & 01110000 & 10010000 \\\\\n00100000 & 01011111 & 11000000 & 01010000 \\\\\n10110000 & 11010000 & 00110000 & 10100000 \\\\\n\\end{pmatrix}\n$$\n<p>Because of this selective encryption scheme, we still know the position of our white pixel after the permutation because 4-bit LSB of the plain image never changes (just looks 4-bit LSB that doesn’t have the value <code class=\"language-text\">0000</code>). </p>\n<p>Just continue using the same method as the previous scenario by solving the linear equations of two variables to find <code class=\"language-text\">p</code> and <code class=\"language-text\">q</code> (value of <code class=\"language-text\">m</code> can still be found through Timing Attack). </p>\n<p>Next, how can we find dynamic <em>keystream</em> value? Meanwhile One-Time Pad is an “unbreakable cipher”. </p>\n<h3 id=\"weak-logistic-map\"><a href=\"#weak-logistic-map\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Weak Logistic Map</h3>\n<p>The only thing we can try to exploit is from the implementation of Logistic Map. </p>\n<p>Analysis of how Logistic Map works is beautifully explained in <u>geoffboeing.com</u> <sup><a href=\"#references\">[2]</a></sup>. Interestingly, there are several things that can make the generation results of Logistic Map repetitive and periodic if the constant <code class=\"language-text\">r</code> and the initial value <code class=\"language-text\">x0</code> are not picked carefully. </p>\n<p>Let’s try to do a little experiment using the implemented Logistic Map based on this article in generating keystream. </p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> random\n<span class=\"token keyword\">import</span> encryption\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    init <span class=\"token operator\">=</span> random<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    r <span class=\"token operator\">=</span> random<span class=\"token punctuation\">.</span>randint<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> random<span class=\"token punctuation\">.</span>random<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'x0:'</span><span class=\"token punctuation\">,</span> init<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'r :'</span><span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'keystream'</span><span class=\"token punctuation\">,</span> encryption<span class=\"token punctuation\">.</span>logistic_map<span class=\"token punctuation\">(</span>init<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Running the script and take some interesting result.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">x0: 0.7244972999777215\nr : 2.2929146462509595\nkeystream: [7, 2, 15, 3, 5, 14, 0, 9, 1, 15, 7, 10, 0, 11, 10, 14, 6, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5]\n\nx0: 0.18893176526337663\nr : 1.6653541535673568\nkeystream: [4, 9, 3, 1, 9, 7, 10, 8, 15, 15, 11, 7, 2, 15, 6, 12, 0, 8, 5, 15, 8, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12]\n\nx0: 0.8927173285063715\nr : 3.5157732279084075\nkeystream: [5, 13, 12, 12, 14, 5, 4, 0, 8, 0, 5, 8, 10, 0, 2, 11, 9, 0, 9, 7, 15, 2, 5, 14, 1, 2, 10, 15, 14, 11, 9, 15, 0, 9, 15, 7, 7, 13, 15, 1, 3, 11, 0, 2, 2, 1, 0, 15, 13, 2, 6, 15, 4, 8, 4, 12, 0, 2, 12, 1, 5, 6, 6, 12, 8, 0, 10, 5, 8, 15, 4, 10, 0, 4, 1, 4, 9, 1, 2, 0, 6, 8, 2, 1, 7, 5, 2, 1, 6, 6, 2, 1, 7, 6, 2, 1, 6, 6, 2, 1, 7, 6, 2, 1, 6, 6, 2, 1, 6, 6, 2, 1, 6, 6, 2, 1, 6, 6, 2, 1, 6, 6, 2, 1, 6, 6, 2, 1, 6, 6, 2, 1, 6, 6, 2, 1, 6, 6, 2, 1, 6, 6, 2, 1, 6, 6, 2, 1, 6, 6, 2, 1]</code></pre></div>\n<p>As we can see from the generated keystream above, the Logistic Map produces sequence that is truly repetitive both statically and periodically.</p>\n<p>Based from the experiment, we can note some value in the constant <code class=\"language-text\">r</code> that will potentially cause repetitive keystream.</p>\n<p>The list of constants <code class=\"language-text\">r</code> that potentially generate a static <em>keystream</em> is: </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1.1 ~ 2.4\n2.6 ~ 2.8\n3.3</code></pre></div>\n<p>Whereas, The list of constants <code class=\"language-text\">r</code> that potentially generate periodic <em>keystream</em> is: </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">2.5\n2.9\n3.1\n3.2\n3.4\n3.5</code></pre></div>\n<p>From the two phenomena above, it can be concluded that the key space in choosing the constant <code class=\"language-text\">r</code> is increasingly limited to avoid repeated keystream, both statically and periodically. </p>\n<p>So, the constant <code class=\"language-text\">r</code> that might be chosen to avoid repetition is to choose one of the following values. </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1.0~\n3.0~\n3.6~\n3.7~\n3.8~\n3.9~</code></pre></div>\n<blockquote>\n<p>For the values of 0.9 and below are ignored because after several generation process, the sequence will tend to 0 values, so it can’t generate large keystream.</p>\n</blockquote>\n<p>So, to get dynamic keystream from the Logistic Map, first we check whether there are repetition in the pixels of the cipher image (especially at the bottom pixels). For static repetition, we simply brute-force 1 out of 16 possible values, while for periodic repetition, we simply brute-force 2 to 4 out of 16 possible values. </p>\n<p>If there is no sign of repetition of the keystream bit, we can brute-force to find the value of the constant <code class=\"language-text\">r</code> from a list of possible values that will not cause repetition previously along with the initial value of <code class=\"language-text\">x0</code>. </p>\n<h3 id=\"proof-of-concept-1\"><a href=\"#proof-of-concept-1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h3>\n<p>Implementation of this attack can be accessed in <a href=\"https://github.com/Merricx/chaos-image-encryption\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">this link</a></p>\n<h1 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h1>\n<p>From the two implementation scenarios that discussed above, it can be concluded that this Chaos-based Image Encryption is truly vulnerable to Chosen-Plain image Attack (Known-Plain image Attack can also viable in some conditions). </p>\n<p>Both the Arnold’s Cat Map, Logistic Map, as well as the use of the selective encryption are vulnerable that can make <em>attacker</em> decrypt any encrypted image without access to the secret key that is currently used. Lastly, further development needs to be studied to produce even better algorithm, especially in terms of security. </p>\n<h1 id=\"references\"><a href=\"#references\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>References</h1>\n<ol>\n<li>Munir, Rinaldi. (2012). ANALISIS KEAMANAN ALGORITMA ENKRIPSI CITRA DIGITAL MENGGUNAKAN KOMBINASI DUA CHAOS MAP DAN PENERAPAN TEKNIK SELEKTIF. JUTI: Jurnal Ilmiah Teknologi Informasi. 10. 89. 10.12962/j24068535.v10i2.a310.  </li>\n<li><a href=\"https://geoffboeing.com/2015/03/chaos-theory-logistic-map/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://geoffboeing.com/2015/03/chaos-theory-logistic-map/</a></li>\n</ol>","timeToRead":15,"frontmatter":{"title":"Don't Roll Your Own Crypto #1","date":"July 28, 2021","spoiler":"The series of cryptanalyzing encryption scheme from local academic paper or article. This first series will discuss about cryptanalysis of image encryption based on Chaos function.","cta":null},"fields":{"slug":"/dont-roll-your-own-crypto-1/","langKey":"en"}}},"pageContext":{"slug":"/dont-roll-your-own-crypto-1/","previous":{"fields":{"slug":"/nahamconctf-elliptical/","langKey":"en","directoryName":"nahamconctf-elliptical","maybeAbsoluteLinks":""},"frontmatter":{"title":"[NahamConCTF 2021] - Elliptical"}},"next":null,"translations":["id"],"translatedLinks":[]}},"staticQueryHashes":["336482444"]}