{"componentChunkName":"component---src-templates-blog-post-js","path":"/id/nahamconctf-elliptical/","result":{"data":{"site":{"siteMetadata":{"title":"Merricx","author":"merricx"}},"markdownRemark":{"id":"f43d253b-8e87-55f3-a367-fd1e8b809734","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a01a38a0dcad4599e0852243d8d126fc/39a20/challs.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRElEQVR42oWQuW7DMBBE9Q1BdFA3SVEnJFGU7cCx4QC5ilRJlTb//xMTkhKEpLGLh9klF7McOt1zh9fvFwxvI86fJ4hLCVcG8BXZIJpYhXCnAN4NnPFdG32d0TzV2H/M4CeO/Ei1MqQPKeJjjvlR4Ocy40568G8ZulmA+8RDQENLyCKEPAHRupzpXpOwZJu5hpPlDEJU4IWwasgph+vpjX5ocT0C1ydrTzbMudGARBtOkuVgRQHKCzC+amEQyJmOz9h6z5FRavsFbmcyykCiGEEYWZw0p6iaBkVZou46W5d1jbptUYgSoqpsbZQLYe8MZr7V83XTIvxrWFY11G7G0I+oAoq+6yFnhUFKyGmyOill63m3g1QT+mHE/nDAMEr4q9FmGKeZ/T9qYkQZKF0iMh1xia9fpZea77C6xrev1T2Jk3+Gvwiy4U3JpgDYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"challs\"\n        title=\"\"\n        src=\"/static/a01a38a0dcad4599e0852243d8d126fc/fcda8/challs.png\"\n        srcset=\"/static/a01a38a0dcad4599e0852243d8d126fc/12f09/challs.png 148w,\n/static/a01a38a0dcad4599e0852243d8d126fc/e4a3f/challs.png 295w,\n/static/a01a38a0dcad4599e0852243d8d126fc/fcda8/challs.png 590w,\n/static/a01a38a0dcad4599e0852243d8d126fc/39a20/challs.png 859w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h1 id=\"challenge\" style=\"position:relative;\"><a href=\"#challenge\" aria-label=\"challenge permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Challenge</h1>\n<p>Disediakan website dimana user dapat <em>sign in</em> dengan username apa saja, kecuali dengan username <code class=\"language-text\">admin</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/591ea1bf0302fb20cd2300e4931b0ec6/fe9e8/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAxElEQVR42q1SXQ+CMAzk//8sY5QEnw2GNxRN/ABEtg7GenaIjyaO0OTSbGvuru0iLBzRrwdrLTRpGNOBiCQbaK3HPIuQyCDNMuRFgbpp8BQ8ymrMPjiE0Bezc7CvFkOrgK4Dk4cREHgYAhxO0qw06niHMk5wX8e4rjYotwkquXMi9Cni/1tmcWWPBWxxQZNmqPcH9Kcz+vwEJy6DZ8iirqRF5VucnFSGcZMJ9EPgUr4EVmbl4c8enRCRBRzP2PLi/3Au4Rsb2RTkCAH7sQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"4\"\n        title=\"\"\n        src=\"/static/591ea1bf0302fb20cd2300e4931b0ec6/fcda8/4.png\"\n        srcset=\"/static/591ea1bf0302fb20cd2300e4931b0ec6/12f09/4.png 148w,\n/static/591ea1bf0302fb20cd2300e4931b0ec6/e4a3f/4.png 295w,\n/static/591ea1bf0302fb20cd2300e4931b0ec6/fcda8/4.png 590w,\n/static/591ea1bf0302fb20cd2300e4931b0ec6/efc66/4.png 885w,\n/static/591ea1bf0302fb20cd2300e4931b0ec6/fe9e8/4.png 1146w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Setelah <em>sign in</em>, website akan menampilkan tampilan static sederhana dengan teks dibawah yang menyatakan bahwa hanya username <code class=\"language-text\">admin</code> yang dapat melihat flag.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c5eeb684cc56b7f78d5e8715d228d346/d5c6f/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaklEQVR42pWS63KCMBSE+/5v5QP4o1NsZ7xjgWAJohIi9+0ep7RqsdLM7CTDIV/2XJ5ws+q6xmq9xmKxhOcHcDcbKBXCdTfQOkbTNKiqCmVZom3b2+t46gMGSp0hnudDheH5LPKDAEGgGA9hsmw4UGuNOI4RcY+iCB9UFGlCLPI8P6uqavStXqBAxNFut4OlE3FjTIY0TZEaw7OBtfYxsEshI0AunE6nXidFUaCgy8FA3/cxHo8xGo2wnK+BqkFLOHNFy4Y4joPZdHp1527K3Q/iMEkSHA4GhbEomWYjUHZXYvkQh7dQGQ8ZE1myF4Q1nSPug7p8+VNmWENLJ1UpdJSsnTTtX8AOKqoJkdSkAdIIcXzv8UEOrx6Q1CV2oUFAqZOlG8MGWDrLqJRj9Fet+4FfwZzDrF8m2FJ68obIecX22UHuvqMOwh95Cg0H/aHDMjngOJ0jnS9xnC2+9z2/WUI7ZSsXRbL/BfwE0JBGcZz6F1cAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"\"\n        src=\"/static/c5eeb684cc56b7f78d5e8715d228d346/fcda8/1.png\"\n        srcset=\"/static/c5eeb684cc56b7f78d5e8715d228d346/12f09/1.png 148w,\n/static/c5eeb684cc56b7f78d5e8715d228d346/e4a3f/1.png 295w,\n/static/c5eeb684cc56b7f78d5e8715d228d346/fcda8/1.png 590w,\n/static/c5eeb684cc56b7f78d5e8715d228d346/efc66/1.png 885w,\n/static/c5eeb684cc56b7f78d5e8715d228d346/c83ae/1.png 1180w,\n/static/c5eeb684cc56b7f78d5e8715d228d346/d5c6f/1.png 1261w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Dari situ dapat disimpulkan bahwa pada challenge ini, kita diharuskan mengubah username kita menjadi <code class=\"language-text\">admin</code> dengan memanfaatkan <em>some crypto magic</em>.</p>\n<p>Lalu, apa yang menjadi indikator yang digunakan oleh website sehingga dia mengetahui siapa yang sedang mengakses website tersebut?</p>\n<h1 id=\"jwt\" style=\"position:relative;\"><a href=\"#jwt\" aria-label=\"jwt permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JWT</h1>\n<p>Tentu saja mekanisme paling umum yang digunakan untuk menyimpan informasi mengenai user yang sedang mengakses sebuah website adalah <strong>cookie</strong>. Website pada challenge ini menggunakan <em>cookie</em> dalam bentuk <strong>JSON Web Token</strong> (JWT) untuk menyimpan informasi mengenai user yang sedang mengakses website tersebut.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/57c0bedc7300c830ff4f512dc65dc40e/1ddef/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 125.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADJ0lEQVR42qWUy44dNRCG+yVA8ARsWEQsuEm8AQ8VlggpSLBgB2/AGoGyQGh2CJjJiDOZPpNz67u73TfbfbP7p+xOhjMhZEaZI32nym3373J1lb2LA8fPJ2c4+esKv51usa8MdqXGvjQ3sM8OlUZA8/9FI6yB85UP7/2vMnz2XY3Pvy/x4FGOT74t8DHx4TcFPiIePCrwwdc5PqVn733J8PbDDO98cZN3ibceMvzwywreySrDj7/+jcd/7vDT71s8Pg2xygyexCPO44nswgv/LHoVI80Z/PHkKbyyyHFxfgaexUjDPfIkgJ4mvMkviiJ4acZwenaOi6e+w/pBlGCmBdrcjpkX7Pq2beFxzhGFERhjKMsSdV2D8/LOUQ3DgKZp3LuMZfCqqoJSCoLUJVlN22qtMY7jK7Fzx9jNbTBZljnrhRTd5aUPf71e8H3HmvxjfP8SQRBACElHE9dIKQlFQXWwwXllWUHSImEXCAFDERrz/8zzfANj5udzi/UYKxDFidthGic61oL1p+nIv54bX4tX8gr9VQ2RKAS5RMQkgkxiGwvsEoEkV9inAkEqwaoOB/ITrhC75xIhW9jTWjvvDX2HpjV4lo4k2JGYwoHYJSRO45ApJ74h+sFg0rNjGM3CZDBO/1pvHHoUasaGa6TViKtY0ssSzyKBLYkmvEMtxjuXkRNkYsYlo8bnE0U1IWs1MhJi1eAK1v7Nz7mTIKcIL0gwzXpgL3Gf37XgutDYsQlJ3IE3A7KyR1x0KMgv6gGMxjan3aBvFywU6Lgj2l6jp4T3lGyLfflF8u1Y0bw2822C3RIh5Y7xATF9Vdnr+xzZCgJbunlV2EErjfk+OWzodonyBpuwQJaX1PBLh7wprvVKThTWVpSvia6k8bWMRy36Mp69tgR1QNvTx+iUu5LuVTZWpFIGW2q3zSFHyiVSKhHbITmVS17bcrG927mySXnvvrqr95eSbcdeT71sn0dUc5tYYR0IrMMWq11DVsAPWleHjZwcQtlczTdEjq1nE2lLyxaxFbIXwZZ62fbxJlouhZAitIUuOu0itxskxXJxuOjJj8hPeYd/APqudJhYkwAnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3\"\n        title=\"\"\n        src=\"/static/57c0bedc7300c830ff4f512dc65dc40e/fcda8/3.png\"\n        srcset=\"/static/57c0bedc7300c830ff4f512dc65dc40e/12f09/3.png 148w,\n/static/57c0bedc7300c830ff4f512dc65dc40e/e4a3f/3.png 295w,\n/static/57c0bedc7300c830ff4f512dc65dc40e/fcda8/3.png 590w,\n/static/57c0bedc7300c830ff4f512dc65dc40e/1ddef/3.png 635w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>JSON Web Token pada dasarnya terdiri atas 3 bagian, yaitu <strong>header</strong>, <strong>payload</strong>, dan <strong>signature</strong>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8e15af8a4abfbf7d8850c3b20b565563/d0fa6/jwt.io.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVR42qWTiWrDMBBE/f//V3rQEEJw6jhufK1uaacr9UpLnKZEMNiIYfRWu6qcc9g1DcZ5QkRCYsa51XUd6rqGMQbee8QYz/oqTgmxHZD2E9CI9gQcFNASnOwF5YpRaw1SqoSFEMALB1eZ6DB47A4R9T6gbiNa+bd9RE8ROqZi5CBEowHI4tIqgWvHuDfvejAJXWQMkuM+IPLHWYtghXaB7LtksWdPtiVe8jOCD6IIloM4cSn5nKqluzjdzZ4UpGFCzxk7XCL8o4TP1c+E7esRSrrsvIOV6XC/lKTBVwbKnWqDx6PCqidsBsJECkT0Q3mUrgsUD0lTVipirRO20uhmNpjGoYyTknHKuj5QCEdj8Sxj1NiEF8votAPN81fY/wIzoQQ+SeDdHPGsGfWkMA43EE7GYSPlHr08BC9PUfsbCCVQCWE7a3mZptxfR7rQnSoHvgGT8f3FPrZx9wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jwt io\"\n        title=\"\"\n        src=\"/static/8e15af8a4abfbf7d8850c3b20b565563/fcda8/jwt.io.png\"\n        srcset=\"/static/8e15af8a4abfbf7d8850c3b20b565563/12f09/jwt.io.png 148w,\n/static/8e15af8a4abfbf7d8850c3b20b565563/e4a3f/jwt.io.png 295w,\n/static/8e15af8a4abfbf7d8850c3b20b565563/fcda8/jwt.io.png 590w,\n/static/8e15af8a4abfbf7d8850c3b20b565563/efc66/jwt.io.png 885w,\n/static/8e15af8a4abfbf7d8850c3b20b565563/c83ae/jwt.io.png 1180w,\n/static/8e15af8a4abfbf7d8850c3b20b565563/d0fa6/jwt.io.png 1263w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Bagian <strong>header</strong> terdiri dari informasi algoritma yang digunakan sebagai pembentuk bagian <strong>signature</strong>.</p>\n<p>Bagian <strong>payload</strong> terdiri dari informasi utama yang disimpan sebagai penanda user tersebut.</p>\n<p>Lalu, bagian <strong>signature</strong> adalah hasil Hash dari <strong>header</strong> dan <strong>payload</strong> yang telah diencode menggunakan <em>Base64</em> menggunakan algoritma yang didefinisikan oleh <strong>alg</strong> pada bagian <strong>header</strong>.</p>\n<p>Bagian <strong>signature</strong> inilah yang digunakan sebagai verifikasi apakah data pada <strong>header</strong> ataupun <strong>payload</strong> telah dilakukan modifikasi atau tidak. Jika data pada <strong>header</strong> atau <strong>payload</strong> dimodifikasi, maka hasil <strong>signature</strong>-nya pasti tidak akan sama, sehingga token akan dianggap tidak valid.</p>\n<p>Setiap bagian akan diencode menggunakan <em>Base64Url</em> dan dipisahkan dengan tanda titik (<strong>.</strong>).</p>\n<p>Pada challenge ini, algoritma Hash yang digunakan adalah <strong>ES256</strong> atau <strong>ECDSA-SHA256</strong> dan pada bagian <strong>payload</strong> hanya berisi data username saja</p>\n<h1 id=\"vulnerability-analysis\" style=\"position:relative;\"><a href=\"#vulnerability-analysis\" aria-label=\"vulnerability analysis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerability Analysis</h1>\n<p>Jika diperhatikan pada web ini, terdapat sedikit keanehan pada <strong>signature</strong> yang dihasilkan ketika kita mencoba <em>sign in</em> berulang kali menggunakan username yang berbeda.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Username: admin1\nwN0kGlDUj5n8x6GGptROB2PskEeOHe-ONvXE6VDWevsS2fyKPc817Sox60QP-jgXhlM0kVkjKFhk-VUgMSOYjg\n\n\nUsername: some random username\nwN0kGlDUj5n8x6GGptROB2PskEeOHe-ONvXE6VDWevuVkYXwniERimgSFQ2cea0-BUwYCLQ60reeuAIyROAxkw\n\n\nUsername: hehehe\nwN0kGlDUj5n8x6GGptROB2PskEeOHe-ONvXE6VDWevsfeMT3XhGF_QCc2Ed1V1V9-F5VPrPSakhNGecWfgQQbw</code></pre></div>\n<p>Yupp, terdapat pengulangan hasil <em>signature</em> yang cukup besar. Algoritma hash yang aman seharusnya ketika terdapat perbedaan meskipun 1 byte inputnya, akan menghasilkan hasil hash yang benar-benar berbeda. Namun disini, hasil <em>signature</em> pada 64 byte pertama tidak pernah berubah meskipun inputnya berbeda.</p>\n<p>Selain itu, jika kita mengulang proses <em>sign in</em> dengan username yang sama berulang-ulang, hasil <em>signature</em> pada JWT kita juga tidak berubah sama sekali.</p>\n<p>Algoritma pada ES256 atau ECDSA adalah algoritma asimetrik dimana pesan yang sama pun seharusnya menghasilkan signature yang berbeda karena sifat <em>random</em> didalamnya.</p>\n<p>Hmmm, berarti disini ada sesuatu yang seharusnya <em>random</em> namun menjadi tidak <em>random</em> :/</p>\n<h1 id=\"ecdsa\" style=\"position:relative;\"><a href=\"#ecdsa\" aria-label=\"ecdsa permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ECDSA</h1>\n<p>Sekilas akan kita bahas bagaimana algoritma ECDSA melakukan <em>sign</em> pada sebuah pesan.</p>\n<p>ECDSA (<em>Elliptic-Curve Digital Signature Algorithm</em>) adalah varian dari algoritma DSA (Algoritma tanda tangan digital) yang menggunakan <em>Elliptic-Curve</em> sebagai kalkulasi penandatangan pesannya.</p>\n<p>Pada <em>Elliptic-Curve</em>, didefinisikan beberapa parameter-parameter sebelum melakukan penghitungan. Berikut adalah parameter yang digunakan spesifik pada ES256 (<em>Elliptic-Curve</em> menggunakan kurva NIST P-256)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">G = (0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296, 0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5)\nn = 115792089210356248762697446949407573529996955224135760342422259061068512044369\nd = random(1, n-1)\nQ = d * G</code></pre></div>\n<p>Dimana</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">G = Elliptic curve base point\nn = integer order of G\nd = private key\nQ = public key</code></pre></div>\n<p>Dimisalkan untuk melakukan tanda tangan pada pesan <code class=\"language-text\">m</code> dilakukan:</p>\n<ul>\n<li>Hitung <code class=\"language-text\">e</code>, dimana <code class=\"language-text\">e = SHA256(m)</code>.</li>\n<li>Hitung nilai <code class=\"language-text\">z</code> dimana <code class=\"language-text\">z = int(e, 16)</code>.</li>\n<li>Pilih nilai <code class=\"language-text\">k</code> yang diambil secara <strong>random</strong> pada interval <code class=\"language-text\">[1, n-1]</code>.</li>\n<li>Hitung kurva <code class=\"language-text\">(x1, x2) = k * G</code></li>\n<li>Hitung <code class=\"language-text\">r = x1 % n</code>. Jika <code class=\"language-text\">r = 0</code>, ulangi pemilihan nilai <code class=\"language-text\">k</code>.</li>\n<li>Hitung <code class=\"language-text\">s = (inverse_mod(k, n) * (z + (r * d) % n)) % n</code>. Jika <code class=\"language-text\">s = 0</code>, ulangi pemilihan nilai <code class=\"language-text\">k</code>.</li>\n<li>Hasil signature yang valid adalah <code class=\"language-text\">(r, s)</code>.</li>\n</ul>\n<h1 id=\"not-so-random-k\" style=\"position:relative;\"><a href=\"#not-so-random-k\" aria-label=\"not so random k permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Not so random k</h1>\n<p>Seperti yang telah kita analisa sebelumnya, bahwa ada kemungkinan sifat <em>random</em> pada proses ECDSA di challenge ini yang tidak <em>random</em>.</p>\n<p>Dari proses penghitungan <em>signing</em> diatas, hanya nilai <code class=\"language-text\">k</code> yang dipilih secara <em>random</em>, sehingga dapat disimpulkan bahwa pada website ini terdapat celah ECDSA <em>Nonce Reuse</em> dimana nilai <code class=\"language-text\">k</code> bersifat <em>static</em> dan digunakan berulang kali pada proses sign yang berbeda.</p>\n<p>Lalu, kenapa bisa nilai <code class=\"language-text\">k</code> yang tidak <em>random</em> dapat menyebabkan celah yang cukup <em>catastrophic</em>?</p>\n<p>Misal diberikan dua signature <code class=\"language-text\">(r, s1)</code> dan <code class=\"language-text\">(r, s2)</code> yang dihasilkan dari <em>signing</em> pesan <code class=\"language-text\">m1</code> dan <code class=\"language-text\">m2</code> menggunakan nilai <code class=\"language-text\">k</code> yang sama, attacker dapat menghitung nilai <code class=\"language-text\">z1</code> dan <code class=\"language-text\">z2</code>.</p>\n<p>Dikarenakan <code class=\"language-text\">s1 - s2 = inverse_mod(k, (z1 - z2))</code>, attacker dapat mencari nilai <code class=\"language-text\">k</code> dengan menghitung:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">k = (z1 - z2) / (s1 - s2)</code></pre></div>\n<p>Lalu, attacker dapat mendapatkan nilai <code class=\"language-text\">d</code> dengan:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">d = (s1 * k - z1) / r</code></pre></div>\n<p>Pada challenge ini, jika kita pecah struktur JWT pada bagian signature kedalam masing-masing 64 byte menghasilkan dua nilai <code class=\"language-text\">(r, s)</code> seperti yang telah dijelaskan, dimana hanya nilai <code class=\"language-text\">s</code> saja yang berubah ketika melakukan sign dengan <code class=\"language-text\">m</code> yang berbeda.\nKarena nilai <code class=\"language-text\">k</code> tidak berubah, maka nilai <code class=\"language-text\">r</code> juga tidak akan berubah, yang menyatakan bahwa analisis kita sebelumnya valid.</p>\n<h1 id=\"proof-of-concept\" style=\"position:relative;\"><a href=\"#proof-of-concept\" aria-label=\"proof of concept permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h1>\n<p>Implementasi python untuk mendapatkan private key dan generate JWT dengan user <code class=\"language-text\">admin</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>number <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">import</span> requests<span class=\"token punctuation\">,</span> base64<span class=\"token punctuation\">,</span> hashlib\n<span class=\"token keyword\">from</span> fastecdsa <span class=\"token keyword\">import</span> ecdsa\n<span class=\"token keyword\">from</span> fastecdsa<span class=\"token punctuation\">.</span>curve <span class=\"token keyword\">import</span> P256\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">auth</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    session <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>Session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    response <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token operator\">=</span><span class=\"token string\">'http://challenge.nahamcon.com:30200/signin'</span><span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span>user<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    token <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>cookies<span class=\"token punctuation\">.</span>get_dict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">]</span>\n    hashed <span class=\"token operator\">=</span> token<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token string\">'.'</span> <span class=\"token operator\">+</span> token<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n    signature <span class=\"token operator\">=</span> token<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\n    raw_signature <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64decode<span class=\"token punctuation\">(</span>signature<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'_'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>  <span class=\"token operator\">+</span> <span class=\"token string\">\"==\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> hashed<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>raw_signature<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">64</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>raw_signature<span class=\"token punctuation\">[</span><span class=\"token number\">64</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">modinv</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> modulus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> modulus <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> modulus<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">divmod</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> modulus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">*</span> modinv<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> modulus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> modulus\n\nm1<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> s1 <span class=\"token operator\">=</span> auth<span class=\"token punctuation\">(</span><span class=\"token string\">'admim'</span><span class=\"token punctuation\">)</span>\nm2<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> s2 <span class=\"token operator\">=</span> auth<span class=\"token punctuation\">(</span><span class=\"token string\">'admio'</span><span class=\"token punctuation\">)</span>\n\norder <span class=\"token operator\">=</span> P256<span class=\"token punctuation\">.</span>q\nz1 <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span>m1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\nz2 <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span>m2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n\nk <span class=\"token operator\">=</span> <span class=\"token builtin\">divmod</span><span class=\"token punctuation\">(</span>z1 <span class=\"token operator\">-</span> z2<span class=\"token punctuation\">,</span> s1 <span class=\"token operator\">-</span> s2<span class=\"token punctuation\">,</span> order<span class=\"token punctuation\">)</span>\nd <span class=\"token operator\">=</span> <span class=\"token builtin\">divmod</span><span class=\"token punctuation\">(</span>k <span class=\"token operator\">*</span> s1 <span class=\"token operator\">-</span> z1<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> order<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[+] Private key:\"</span><span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span>\n\nnew_token <span class=\"token operator\">=</span> <span class=\"token string\">b'eyJhbGciOiAiRVMyNTYiLCAidHlwIjogIkpXVCJ9.'</span> <span class=\"token operator\">+</span> base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span><span class=\"token string\">b'{\"username\":\"admin\"}'</span><span class=\"token punctuation\">)</span>\nr<span class=\"token punctuation\">,</span> s <span class=\"token operator\">=</span> ecdsa<span class=\"token punctuation\">.</span>sign<span class=\"token punctuation\">(</span>new_token<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[+] Forged signature:\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nnew_token <span class=\"token operator\">+=</span> <span class=\"token string\">b\".\"</span> <span class=\"token operator\">+</span> base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> long_to_bytes<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">b'+'</span><span class=\"token punctuation\">,</span><span class=\"token string\">b'-'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">b'/'</span><span class=\"token punctuation\">,</span><span class=\"token string\">b'_'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">b'='</span><span class=\"token punctuation\">,</span><span class=\"token string\">b''</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[+] JWT:\"</span><span class=\"token punctuation\">,</span> new_token<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Jalankan dan didapatkan JWT yang valid</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">~$ python solve_elliptic.py\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Private key: <span class=\"token number\">76360441104529975103479885636071599682318869381694694853301440181334888705951</span>\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Forged signature: <span class=\"token punctuation\">(</span><span class=\"token number\">66378196147239170843827166360250592759597163597715304772573917957470106804741</span>, <span class=\"token number\">106147551365476994967159598162752611693743616349309630180573719192813726918650</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> JWT: <span class=\"token assign-left variable\">eyJhbGciOiAiRVMyNTYiLCAidHlwIjogIkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0</span><span class=\"token operator\">=</span>.ksC6RjVxDXfXips96dGXrpC0DoB87qpDSrBrBgn14gXqrWKQDWejXdEUJmwIoIVIcIrt8IuDGIRzZbPzbIjn-g</code></pre></div>\n<p>Masukkan JWT tersebut sebagai cookie pada web challenge dan didapatkan flag :D</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/620c218a063a1ad134d6cac508bdaeb7/d5c6f/flag.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABcklEQVR42pWTW3OCMBCF/f9/y776UNuxKloxYBEDSIVwD6e7afE2ttDMnNlJ2Hw5uwkj3I2mabAVwmhj2xCOA8dxzVwIB7vdzihJErRte78do0fAMAxxjCIEQWgkgwABraksQ1mWRpz3aDwEShnA8/aICKqUOotdJWlKMUVG8EFAHpyc5zk5KaC1Bld2XV1VVajruh/Y9cR1XUwmE4yfxtist9BUXVG0JEDXGtPpMyzLutnzp0NO4vKkPCCOT+S2pv6V5Izc1g3SNEH+n5K7U5umNj3VuqWoyWF5cdRi2C1fJ3Efa3LF7SI2zavL7Q4FdlAWb+aL+VZJ4OrXwwc57FsfBOQnwc8m5bdHUWXKPOqqov6hPbvv1AtUqYL0Jfy9j1CGiIIIW1ugyIsfVwMddp+O+SdevQWW8h2Lwxrzwwqr0IZltIE40b+c+hDJB05l0g+MsiNevDne/BVmewszb0lxaSIfxHA7drGOtpQb3+xl4Bd6z0YB9pJ5wgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flag\"\n        title=\"\"\n        src=\"/static/620c218a063a1ad134d6cac508bdaeb7/fcda8/flag.png\"\n        srcset=\"/static/620c218a063a1ad134d6cac508bdaeb7/12f09/flag.png 148w,\n/static/620c218a063a1ad134d6cac508bdaeb7/e4a3f/flag.png 295w,\n/static/620c218a063a1ad134d6cac508bdaeb7/fcda8/flag.png 590w,\n/static/620c218a063a1ad134d6cac508bdaeb7/efc66/flag.png 885w,\n/static/620c218a063a1ad134d6cac508bdaeb7/c83ae/flag.png 1180w,\n/static/620c218a063a1ad134d6cac508bdaeb7/d5c6f/flag.png 1261w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","timeToRead":5,"frontmatter":{"title":"[NahamConCTF 2021] - Elliptical","date":"March 15, 2021","spoiler":"Write-up Elliptical - NahamConCTF 2021","cta":"crypto"},"fields":{"slug":"/id/nahamconctf-elliptical/","langKey":"id"}}},"pageContext":{"slug":"/id/nahamconctf-elliptical/","translations":["id"],"translatedLinks":[]}},"staticQueryHashes":["336482444"],"slicesMap":{}}