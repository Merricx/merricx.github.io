{"componentChunkName":"component---src-templates-blog-post-js","path":"/nahamconctf-elliptical/","result":{"data":{"site":{"siteMetadata":{"title":"Merricx","author":"merricx"}},"markdownRemark":{"id":"7822970a-b253-50b8-b35c-3fe42150cf54","html":"<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a01a38a0dcad4599e0852243d8d126fc/39a20/challs.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABVklEQVQoz31Qy07DMBDMNyCSOO/Yie04IWnSlKoShRYJOHDjwIEP4P8/YVi7kFYIcRjNzng1u2tP3FV4+XhG/zRg/7aHORr4Y4hgYg7hFBEYUuJgZO7tP3j60ODx/Qj9oLB93UDeSxS7AhUNyrc5MqqbncDn4RaMgv3pPOwveH7OcJX6CMuYEIHxBLFIEREz58WuzkS26B/81hZelpWQUqOqJWpiWwtRww/oxPAEW18HbNGXvuWQUThLHLwky8GrGqWoiKuFRW09gYKLb18gLzlp7ryTXzuOkhRhRKExBaZ5Dm0Mbaeguxa6baF0g4a4VgpSaTSmhdR0hZSOVdO4ftN2MF2HJM3OgXbKtF5jWK2gIo5WGYzzGv0wYDWO6Mkfp8nV0zxjpN6bfsC82TjfbhewyIXZUC+mdHsep1PLpEBZ8EXbU+1Au5Vjdfpr+y22x256uZ3FF8PV4FIlVwxrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"challs\"\n        title=\"\"\n        src=\"/static/a01a38a0dcad4599e0852243d8d126fc/fcda8/challs.png\"\n        srcset=\"/static/a01a38a0dcad4599e0852243d8d126fc/12f09/challs.png 148w,\n/static/a01a38a0dcad4599e0852243d8d126fc/e4a3f/challs.png 295w,\n/static/a01a38a0dcad4599e0852243d8d126fc/fcda8/challs.png 590w,\n/static/a01a38a0dcad4599e0852243d8d126fc/39a20/challs.png 859w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id=\"challenge\"><a href=\"#challenge\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Challenge</h1>\n<p>Given website where user can sign in with any username, except with username <code class=\"language-text\">admin</code>.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/591ea1bf0302fb20cd2300e4931b0ec6/fe9e8/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 50.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA5ElEQVQoz5WSW4vCMBCF/f//SnZBF30QZBHxsrL44qW2RdOk20w/k9RC13sHDjMkJycnM+nQiLIs/+VH4fcfcTv3iB7WWowx5HmO1ibUWuuQWwv6UFnGZDrld70mTlKSNGUfRSFfX/5UkJoognXOxDnkso5bc9bDXpP7+sm+dg7jryGH/oDtR49N95OoNyDuD5HjqeK0ERTft/kPZrkiGX8Tj8aYxQo9WyIqayNYZXFQbggq09RHEgM7Bbnl8tw3htJ0WhRFgISeCaYo0X/uB0ijNW0Eb6df4e1vc024Fa5wj1vHGfoHFAWKnlRGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"4\"\n        title=\"\"\n        src=\"/static/591ea1bf0302fb20cd2300e4931b0ec6/fcda8/4.png\"\n        srcset=\"/static/591ea1bf0302fb20cd2300e4931b0ec6/12f09/4.png 148w,\n/static/591ea1bf0302fb20cd2300e4931b0ec6/e4a3f/4.png 295w,\n/static/591ea1bf0302fb20cd2300e4931b0ec6/fcda8/4.png 590w,\n/static/591ea1bf0302fb20cd2300e4931b0ec6/efc66/4.png 885w,\n/static/591ea1bf0302fb20cd2300e4931b0ec6/fe9e8/4.png 1146w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>After signed in, website will show simple static text and image that shown below and the bottom text that says “Sorry, only admin can see the flag”.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c5eeb684cc56b7f78d5e8715d228d346/d5c6f/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAABcUlEQVQ4y42TW3OCMBCF/f//yj771KIW6w0VQgXRCgTCJae7QafUUmFnzgTD7ufZbBiBQmttxFFVFbaOg+VqjYPrYrfbQwgBx9khCEOTV5YliqL4VXdfR11ABgjh43BwIXzfPLNcz4PnCaMkSYYD2Ul4OiEIQhyDwCggpWkKpRSyPDd5bdBzIBWzo1MUQUppQKzrNUYcx8Yd7z8FtlcullmGjFRVNR6Dz4+d9gLruin26KwmkwnGL2OsPjZAWUMTXFOrmgZiWRYWtj3MYdtlRC1/XWLkiYSiVmuCkj1Iepfz87OhtIE/51kb1/rmntusb+8eDQwCpuSsTHNypYyzgoB8B7tye4G8U1Ext6bo7HKC8TBMXpM8DPhfmIG1/7APeN9Q5CKjFlNyJckVK+EBdIQecrGz6IyjNYP/NsVxOjcSrxYyZ4+CLnujTxSuQEWTb7ff/aWcL5DzBaS9RPp+W+l3PLOh1g5p26zLDcro8mfa3zNARaAiUxbEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"1\"\n        title=\"\"\n        src=\"/static/c5eeb684cc56b7f78d5e8715d228d346/fcda8/1.png\"\n        srcset=\"/static/c5eeb684cc56b7f78d5e8715d228d346/12f09/1.png 148w,\n/static/c5eeb684cc56b7f78d5e8715d228d346/e4a3f/1.png 295w,\n/static/c5eeb684cc56b7f78d5e8715d228d346/fcda8/1.png 590w,\n/static/c5eeb684cc56b7f78d5e8715d228d346/efc66/1.png 885w,\n/static/c5eeb684cc56b7f78d5e8715d228d346/c83ae/1.png 1180w,\n/static/c5eeb684cc56b7f78d5e8715d228d346/d5c6f/1.png 1261w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Based on that observation, we can conclude that in this challenge, we must change our username to <code class=\"language-text\">admin</code> by exploiting “some crypto magic”.</p>\n<p>So, what is the indicator that used by website so that it knows who is currently accessing the page?</p>\n<h1 id=\"jwt\"><a href=\"#jwt\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JWT</h1>\n<p>Of course, the most common mechanism to store information about the user that currently accessing a website is called <strong>cookie</strong>.<br>\nIn this challenge, cookie is used in the form of JSON Web Token (JWT) to store the information about current user.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/57c0bedc7300c830ff4f512dc65dc40e/1ddef/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 125.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAYAAAAxFw7TAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADQ0lEQVQ4y52VS4/cRBDH+2sgIfgEnII4gAhfgc8EHJECEpADB7gicciBC1IkRFCk5QJZBMnOeDKz64zH72f71d22/1T1PDaJGGa1ln7T7bb776rqqhqxiXL8dvYHnjxd4PxihaKbULQjjVvKHbxW9SNqNb3GCEnrjQZmzgLizr0IH90v8PF3Ge7ci3H3fo4Pv07x/lcpPiDe/SLBe18muPtNinc+j/HmpxHe+uxV3ibe+CTBtz8/g/jpzwjfP7zAg99d/PDYxY9nHh5fGjx6riy/7ni0VPhlofBw3hPqJfotjsHZkxlEV6Vw/jlHEW+QbFzkkQdgwm2uwPcgwijG+V9/YzZ3cDFz7NzzQytpxgnDKabrz0spIdI0heu6pB4gjhPwfUQfmfhF+jmF1hp1XaOqKgRBAFEUBfq+R9u2dtxfwzAcYdwxYBxH5HlOBkQkFsL3fQjP8+A4zoH5fL7DOcDrs9nMesJusTV7pKythWwQeyeyLIOsJMqiREEopaDIDaV2vDTXxlDcxmt2lu4x9Fxw3DZhiIa+YGjzwJuYYYe5xuxHes+YV5/tn9OhZGicDG1Qw0sabOIGXlTjKpBwiSBtsQ5ruxbn3WHNp3df0Po62sJzXhd916EuRywDBTfuaHODK2Ll04sxiUUtlpsaC0+i6Qb0eqQwjGj74UCnaFTbuVB9h4wOd5kNiEqNJQlZNmxlQ5a0yCp142S3gkkzYR4brHMiMfBLY4X8tLPJu8+58QZ5aQXzdsIzEgwjMtVtTlrBG//XwowE58mAq1gj9FoUUiEpe4RZZ91l+D4gizlee9H/Ej4IrjNN/Y4CS8XJm5rOQLbmEHi+rxrOxfG0ILu8IJfjQiGk2LHAKZePxlCrHjmFbpVTN1630NJgxO0vIblLZA2lSY44KTHaEtqW0W0Q3KqSmKCOkSQpdRxNqJMcav01hJQVOj2B4k81Sr5PN3P4WOKInppC3gxYRR0u1zHVa4OU06Sg2FL6MJw+Yb4lpvVeD0cPR3RUy/b/gDat/IZqlup2LfH0srT167yQiOjUCqltPnLqmOG4F0JrRSUF6jQtZm4Fh8See1t4zoLcJFiUc5GTm63ksvS4eRAb2ruf/wu5pnJ1JKF9fAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"3\"\n        title=\"\"\n        src=\"/static/57c0bedc7300c830ff4f512dc65dc40e/fcda8/3.png\"\n        srcset=\"/static/57c0bedc7300c830ff4f512dc65dc40e/12f09/3.png 148w,\n/static/57c0bedc7300c830ff4f512dc65dc40e/e4a3f/3.png 295w,\n/static/57c0bedc7300c830ff4f512dc65dc40e/fcda8/3.png 590w,\n/static/57c0bedc7300c830ff4f512dc65dc40e/1ddef/3.png 635w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Basically, JSON Web Token consists of 3 main parts, which is <strong>header</strong>, <strong>payload</strong>, and <strong>signature</strong>.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8e15af8a4abfbf7d8850c3b20b565563/d0fa6/jwt.io.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABa0lEQVQ4y42TaY+CMBiE/f8/bz+4iUY3m6wiiECh9zX7lirBg3WbTC/ow7RTVtoYFOUJjPfwiKMiMGoqNGiaBkVRQCsF5xy89/lRjHdahRBgyxbhxICyB6oBqAVw5jDUt0KPCznn6PkAYy0s6RF0B6xbi2PlcSgsDieLqnRQtUPDLIQN2aKndiA411gqGUjVXgV8ShK1a2prH9GGCDt70ZErrzSiz4ey6DBVuOo2OfvkNKe1gTUOkYxG/wZ4B3k46Ns4uAAnHYKmeffHlqfFC6DcjxSIwKXryKUmuIWh22GvASWlccpj9Qh4dpq33gqFD0p/03B8tylxPiY/V7pO74HXs+QUyI47bElfFFzRSzDWQUgJIcQITHfz30AmNfbC42wCKhPRSIOh7zPsCnzp8FkZOJDDzeCwJu3I4Q8TYF12uLjll8nNHG5FwJFSPhqgEMkhm7b7BHwnQQ7LQdEfqVCRLlxCEkzMlM7wF4or/JjBpW46AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"jwt io\"\n        title=\"\"\n        src=\"/static/8e15af8a4abfbf7d8850c3b20b565563/fcda8/jwt.io.png\"\n        srcset=\"/static/8e15af8a4abfbf7d8850c3b20b565563/12f09/jwt.io.png 148w,\n/static/8e15af8a4abfbf7d8850c3b20b565563/e4a3f/jwt.io.png 295w,\n/static/8e15af8a4abfbf7d8850c3b20b565563/fcda8/jwt.io.png 590w,\n/static/8e15af8a4abfbf7d8850c3b20b565563/efc66/jwt.io.png 885w,\n/static/8e15af8a4abfbf7d8850c3b20b565563/c83ae/jwt.io.png 1180w,\n/static/8e15af8a4abfbf7d8850c3b20b565563/d0fa6/jwt.io.png 1263w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p><strong>header</strong> contains the information about algorithm that is used to sign and build <strong>signature</strong> part. </p>\n<p><strong>payload</strong> contains main information about the user that currently accessing the web.</p>\n<p>And then, <strong>signature</strong> is the hash result of <strong>header</strong> and <strong>payload</strong> (Base64-encoded and concatenated by dot) using algorithm that defined by <strong>alg</strong> in <strong>header</strong> part.</p>\n<p>This <strong>signature</strong> then is used as verification whether data on <strong>header</strong> or <strong>payload</strong> has been modified or not. If data on <strong>header</strong> or <strong>payload</strong> has been modified or forged, then the result of <strong>signature</strong> will not be the same, thus the token will be considered invalid.</p>\n<p>Every part of JWT will be encoded with Base64Url and separated with dot sign (<strong>.</strong>).</p>\n<p>In this challenge, the hash algorithm use <strong>ES256</strong> or <strong>ECDSA-SHA256</strong>. On the <strong>payload</strong> part, it only contains <code class=\"language-text\">username</code> of the current user.</p>\n<h1 id=\"vulnerability-analysis\"><a href=\"#vulnerability-analysis\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vulnerability Analysis</h1>\n<p>If we pay attention to the signing process in this web, there’s an oddity on the resulting <strong>signature</strong> after we signed in multiple times, as shown below.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Username: admin1\nwN0kGlDUj5n8x6GGptROB2PskEeOHe-ONvXE6VDWevsS2fyKPc817Sox60QP-jgXhlM0kVkjKFhk-VUgMSOYjg\n\n\nUsername: some random username\nwN0kGlDUj5n8x6GGptROB2PskEeOHe-ONvXE6VDWevuVkYXwniERimgSFQ2cea0-BUwYCLQ60reeuAIyROAxkw\n\n\nUsername: hehehe\nwN0kGlDUj5n8x6GGptROB2PskEeOHe-ONvXE6VDWevsfeMT3XhGF_QCc2Ed1V1V9-F5VPrPSakhNGecWfgQQbw</code></pre></div>\n<p>Yupp, there’s big repeating signature result even with completely different username.</p>\n<p>A secure hash algorithm when there’s little input difference, even only 1 byte, it should produce a completely different hash result. But in this web, the first 64 byte on the resulting signature never change.</p>\n<p>Other than that, if we repeat the signing process with same username, the resulting signature also never change.</p>\n<p>Whereas, algorithm in ES256 or ECDSA is asymmetric algorithm that even the same message should produce different signature because the random property in it.</p>\n<p>So, we can conclude that there’s something that should be random but it isn’t :/</p>\n<h1 id=\"ecdsa\"><a href=\"#ecdsa\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ECDSA</h1>\n<p>We will briefly discuss how ECDSA algorithm signing a message.</p>\n<p>ECDSA (<em>Elliptic-Curve Digital Signature Algorithm</em>) is the variant of DSA (Digital Signature Algorithm) which uses Elliptic-Curve as its signature calculation.</p>\n<p>In the Elliptic-Curve, there’s some parameters that defined before doing any calculations. Here are the parameters used specifically in ES256.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">G = (0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296, 0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5)\nn = 115792089210356248762697446949407573529996955224135760342422259061068512044369\nd = random(1, n-1)\nQ = d * G</code></pre></div>\n<p>where</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">G = Elliptic curve base point\nn = integer order of G\nd = private key\nQ = public key</code></pre></div>\n<p>Suppose we want to sign message <code class=\"language-text\">m</code>, then we do the following steps:</p>\n<ul>\n<li>Calculate <code class=\"language-text\">e</code>, where <code class=\"language-text\">e = SHA256(m)</code>.</li>\n<li>Calculate <code class=\"language-text\">z</code> where <code class=\"language-text\">z = int(e, 16)</code>.</li>\n<li>Pick random integer <code class=\"language-text\">k</code> from interval <code class=\"language-text\">[1, n-1]</code>.</li>\n<li>Calculate the curve point <code class=\"language-text\">(x1, x2) = k * G</code></li>\n<li>Calculate <code class=\"language-text\">r = x1 % n</code>. If <code class=\"language-text\">r = 0</code>, repeat the <code class=\"language-text\">k</code> selection.</li>\n<li>Calculate <code class=\"language-text\">s = (inverse_mod(k, n) * (z + (r * d) % n)) % n</code>. If <code class=\"language-text\">s = 0</code>, repeat the <code class=\"language-text\">k</code> selection.</li>\n<li>The valid signature is the pair <code class=\"language-text\">(r, s)</code>.</li>\n</ul>\n<h1 id=\"not-so-random-k\"><a href=\"#not-so-random-k\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Not so random k</h1>\n<p>As we have analyzed previously, there’s possibility that the “random” on the ECDSA in this challenge is not random.</p>\n<p>From the signing calculations that we have discussed above, only <code class=\"language-text\">k</code> that was picked randomly. Therefore, we can assume that in this website, there’s Nonce reuse vulnerability, where integer <code class=\"language-text\">k</code> is static and used repeatedly on the different signing process.</p>\n<p>Then, why the value of <code class=\"language-text\">k</code> that is not random can cause dangerous flaw on this website?</p>\n<p>Given two valid signature <code class=\"language-text\">(r, s1)</code> and <code class=\"language-text\">(r, s2)</code> from the signing message <code class=\"language-text\">m1</code> and <code class=\"language-text\">m2</code> using the same <code class=\"language-text\">k</code>, attacker can trivially calculate <code class=\"language-text\">z1</code> and <code class=\"language-text\">z2</code>.</p>\n<p>And because <code class=\"language-text\">s1 - s2 = inverse_mod(k, (z1 - z2))</code>, attacker can find <code class=\"language-text\">k</code> by calculate:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">k = (z1 - z2) / (s1 - s2)</code></pre></div>\n<p>Then, attacker can easily find <code class=\"language-text\">d</code> with:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">d = (s1 * k - z1) / r</code></pre></div>\n<h1 id=\"proof-of-concept\"><a href=\"#proof-of-concept\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proof of Concept</h1>\n<p>Let’s implement the attack in Python to get the private key and generate valid JWT with username <code class=\"language-text\">admin</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> Crypto<span class=\"token punctuation\">.</span>Util<span class=\"token punctuation\">.</span>number <span class=\"token keyword\">import</span> <span class=\"token operator\">*</span>\n<span class=\"token keyword\">import</span> requests<span class=\"token punctuation\">,</span> base64<span class=\"token punctuation\">,</span> hashlib\n<span class=\"token keyword\">from</span> fastecdsa <span class=\"token keyword\">import</span> ecdsa\n<span class=\"token keyword\">from</span> fastecdsa<span class=\"token punctuation\">.</span>curve <span class=\"token keyword\">import</span> P256\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">auth</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    session <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>Session<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    response <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>post<span class=\"token punctuation\">(</span>url<span class=\"token operator\">=</span><span class=\"token string\">'http://challenge.nahamcon.com:30200/signin'</span><span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token string\">'username'</span><span class=\"token punctuation\">:</span>user<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n    token <span class=\"token operator\">=</span> session<span class=\"token punctuation\">.</span>cookies<span class=\"token punctuation\">.</span>get_dict<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'token'</span><span class=\"token punctuation\">]</span>\n    hashed <span class=\"token operator\">=</span> token<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> <span class=\"token string\">'.'</span> <span class=\"token operator\">+</span> token<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n    signature <span class=\"token operator\">=</span> token<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">'.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\n    raw_signature <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64decode<span class=\"token punctuation\">(</span>signature<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'-'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'+'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">'_'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>  <span class=\"token operator\">+</span> <span class=\"token string\">\"==\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">hex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> hashed<span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>raw_signature<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token number\">64</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>raw_signature<span class=\"token punctuation\">[</span><span class=\"token number\">64</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">modinv</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> modulus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">pow</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> modulus <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> modulus<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">divmod</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">,</span> modulus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>a <span class=\"token operator\">*</span> modinv<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> modulus<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> modulus\n\nm1<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> s1 <span class=\"token operator\">=</span> auth<span class=\"token punctuation\">(</span><span class=\"token string\">'admim'</span><span class=\"token punctuation\">)</span>\nm2<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> s2 <span class=\"token operator\">=</span> auth<span class=\"token punctuation\">(</span><span class=\"token string\">'admio'</span><span class=\"token punctuation\">)</span>\n\norder <span class=\"token operator\">=</span> P256<span class=\"token punctuation\">.</span>q\nz1 <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span>m1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\nz2 <span class=\"token operator\">=</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">(</span>hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span>m2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span>\n\nk <span class=\"token operator\">=</span> <span class=\"token builtin\">divmod</span><span class=\"token punctuation\">(</span>z1 <span class=\"token operator\">-</span> z2<span class=\"token punctuation\">,</span> s1 <span class=\"token operator\">-</span> s2<span class=\"token punctuation\">,</span> order<span class=\"token punctuation\">)</span>\nd <span class=\"token operator\">=</span> <span class=\"token builtin\">divmod</span><span class=\"token punctuation\">(</span>k <span class=\"token operator\">*</span> s1 <span class=\"token operator\">-</span> z1<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> order<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[+] Private key:\"</span><span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span>\n\nnew_token <span class=\"token operator\">=</span> <span class=\"token string\">b'eyJhbGciOiAiRVMyNTYiLCAidHlwIjogIkpXVCJ9.'</span> <span class=\"token operator\">+</span> base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span><span class=\"token string\">b'{\"username\":\"admin\"}'</span><span class=\"token punctuation\">)</span>\nr<span class=\"token punctuation\">,</span> s <span class=\"token operator\">=</span> ecdsa<span class=\"token punctuation\">.</span>sign<span class=\"token punctuation\">(</span>new_token<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[+] Forged signature:\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nnew_token <span class=\"token operator\">+=</span> <span class=\"token string\">b\".\"</span> <span class=\"token operator\">+</span> base64<span class=\"token punctuation\">.</span>b64encode<span class=\"token punctuation\">(</span>long_to_bytes<span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> long_to_bytes<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">b'+'</span><span class=\"token punctuation\">,</span><span class=\"token string\">b'-'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">b'/'</span><span class=\"token punctuation\">,</span><span class=\"token string\">b'_'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">b'='</span><span class=\"token punctuation\">,</span><span class=\"token string\">b''</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"[+] JWT:\"</span><span class=\"token punctuation\">,</span> new_token<span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Run the script and we got the valid JWT.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">~$ python solve_elliptic.py\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Private key: <span class=\"token number\">76360441104529975103479885636071599682318869381694694853301440181334888705951</span>\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> Forged signature: <span class=\"token punctuation\">(</span><span class=\"token number\">66378196147239170843827166360250592759597163597715304772573917957470106804741</span>, <span class=\"token number\">106147551365476994967159598162752611693743616349309630180573719192813726918650</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> JWT: eyJhbGciOiAiRVMyNTYiLCAidHlwIjogIkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0<span class=\"token operator\">=</span>.ksC6RjVxDXfXips96dGXrpC0DoB87qpDSrBrBgn14gXqrWKQDWejXdEUJmwIoIVIcIrt8IuDGIRzZbPzbIjn-g</code></pre></div>\n<p>Insert the resulting JWT as a cookie and we got the flag :D</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/620c218a063a1ad134d6cac508bdaeb7/d5c6f/flag.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 70.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAABd0lEQVQ4y5VT2W6DMBDM//9W+hopRW0aUhquJoQzhBuDPV0bpaI56UqjNdbuePZgBjIhhIK0vu9h2w5sx8HWtMi7cFxXfUt873YKWZ7/yTv72S3COI6RJAmiKCZECAnyXFUV2rZF0zQqbkz0kDAMI3ieR8SJIinLUiEnVQMKlHT/kHDsJYlUIdVwPtyNres6BYgnhJxz5XfUo8VigfnLHKZhoafcuhH0iADvODRNg65vhpxnCs/nLMsQBAHS44kUMyq5JcUcnPUoilxVMankMalU3HU99VWQ52jq5lfRpYBJhHVdgzFJBoW6aofe3Yh9SighJz4MZwBjbIhT05io8J4Jcf3gpMVuSUVFpRZy9+QOEiJadLlCUhkX/H+EZVEi9EP4hwBxSH9MfIRl2mANu6P8CWFan/DubfAZmtgEW+jBF4zIghEPcLI99oUPN/eQtfnVtK8IkzrF8rDCW6BD89d4PXwor5Ffeiusky2M1IZ+NBFT7GX+D18ARPkSr8iYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"flag\"\n        title=\"\"\n        src=\"/static/620c218a063a1ad134d6cac508bdaeb7/fcda8/flag.png\"\n        srcset=\"/static/620c218a063a1ad134d6cac508bdaeb7/12f09/flag.png 148w,\n/static/620c218a063a1ad134d6cac508bdaeb7/e4a3f/flag.png 295w,\n/static/620c218a063a1ad134d6cac508bdaeb7/fcda8/flag.png 590w,\n/static/620c218a063a1ad134d6cac508bdaeb7/efc66/flag.png 885w,\n/static/620c218a063a1ad134d6cac508bdaeb7/c83ae/flag.png 1180w,\n/static/620c218a063a1ad134d6cac508bdaeb7/d5c6f/flag.png 1261w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>","timeToRead":7,"frontmatter":{"title":"[NahamConCTF 2021] - Elliptical","date":"March 15, 2021","spoiler":"Write-up Elliptical - NahamConCTF 2021","cta":"crypto"},"fields":{"slug":"/nahamconctf-elliptical/","langKey":"en"}}},"pageContext":{"slug":"/nahamconctf-elliptical/","previous":{"fields":{"slug":"/how-i-get-free-movie-tickets/","langKey":"en","directoryName":"how-i-get-free-movie-tickets","maybeAbsoluteLinks":""},"frontmatter":{"title":"How I Got Free Movie Tickets by Abusing QR-Code"}},"next":null,"translations":["id"],"translatedLinks":[]}},"staticQueryHashes":["336482444"]}